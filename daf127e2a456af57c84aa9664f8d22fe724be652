{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e919567c_19c4a752",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 580,
      "author": {
        "id": 1060151
      },
      "writtenOn": "2021-02-10T01:25:52Z",
      "side": 1,
      "message": "since this is checked in sendMessage(), I don\u0027t think it has to be checked here.",
      "range": {
        "startLine": 580,
        "startChar": 20,
        "endLine": 580,
        "endChar": 47
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4034ab59_bb2821e3",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 580,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-11T07:37:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e919567c_19c4a752",
      "range": {
        "startLine": 580,
        "startChar": 20,
        "endLine": 580,
        "endChar": 47
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "91c6aa3a_a7b37715",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 623,
      "author": {
        "id": 1060151
      },
      "writtenOn": "2021-02-10T01:25:52Z",
      "side": 1,
      "message": "same",
      "range": {
        "startLine": 623,
        "startChar": 24,
        "endLine": 623,
        "endChar": 51
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "01bf433c_8242c729",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 623,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-11T07:37:54Z",
      "side": 1,
      "message": "are we sure we want this removed? Since this is invoked outside of VcnGatewayConnection (in UnderlyingNetworkTracker), it is somewhat harder to guarantee it is invoked on the same Thread.\n\nIt may be worth the redundant check for the safety (especially with the WakeupMessage assignment here in aosp/1574005)",
      "parentUuid": "91c6aa3a_a7b37715",
      "range": {
        "startLine": 623,
        "startChar": 24,
        "endLine": 623,
        "endChar": 51
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "04b14640_7bc12b9c",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 623,
      "author": {
        "id": 1060151
      },
      "writtenOn": "2021-02-11T22:05:32Z",
      "side": 1,
      "message": "If it\u0027s redundant, then it doesn\u0027t provide additional safety...\n\nBut, it looks like there is a problem. the UnderlyingNetworkTracker.callback() should be invoked on a provided Handler (or Executor). Right now it\u0027s not because there\u0027s not a handler/executor parameter AFAIK. Let\u0027s fix that!",
      "parentUuid": "01bf433c_8242c729",
      "range": {
        "startLine": 623,
        "startChar": 24,
        "endLine": 623,
        "endChar": 51
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8f4df9f4_b80db237",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 623,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-12T20:06:21Z",
      "side": 1,
      "message": "Sorry, I\u0027m not sure I explained this correctly last time.\n\nUnderlyingNetworkTracker.callback() is currently only invoked from the NetworkCallbacks in UNT and the NetworkCallbacks are registered to ConnectivityService with the VCN Looper. This means everything is already safe as-is and we do not technically need to check that we are on the Looper thread.\n\nI am proposing we keep this check because it is cheap and will protect us in the future (just in case the NetworkCallback registration ever changes). Thoughts?",
      "parentUuid": "04b14640_7bc12b9c",
      "range": {
        "startLine": 623,
        "startChar": 24,
        "endLine": 623,
        "endChar": 51
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "257dbaee_90116009",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 623,
      "author": {
        "id": 1060151
      },
      "writtenOn": "2021-02-12T20:29:33Z",
      "side": 1,
      "message": "We can discuss for a future cleanup (or possibly a larger change). As-is, it\u0027s a code smell, but it\u0027s definitely not hurting anything.",
      "parentUuid": "8f4df9f4_b80db237",
      "range": {
        "startLine": 623,
        "startChar": 24,
        "endLine": 623,
        "endChar": 51
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d1c8cb14_d47e900e",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 623,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-12T21:40:26Z",
      "side": 1,
      "message": "Created b/180132994 and added a TODO to circle back\n\nMarking resolved for the time being",
      "parentUuid": "257dbaee_90116009",
      "range": {
        "startLine": 623,
        "startChar": 24,
        "endLine": 623,
        "endChar": 51
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6633c8e6_2fac8aee",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 669,
      "author": {
        "id": 1060151
      },
      "writtenOn": "2021-02-10T01:25:52Z",
      "side": 1,
      "message": "I spoke with Ben about this. It\u0027s a little scary to override sendMessage like this. My preference would be to do this in 2 steps:\n\n1) override sendMessage() with (at least) a WTF() taht doesn\u0027t grab the wakelock.\n2) make a new method like sendWakeLockedMessage() and use that instead.",
      "range": {
        "startLine": 669,
        "startChar": 16,
        "endLine": 669,
        "endChar": 27
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7b0279e4_5dff7fa6",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 669,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-11T07:37:54Z",
      "side": 1,
      "message": "Per our conversation offline, moving to only use sendMessageAndAcquireWakeLock() for all sendMessage() calls. Also overrode all sendMessage() methods to Log.wtf()\n\nAdditionally, will document at the class-level that future classes should use this new sendMessage() unless there is an explicit reason not to",
      "parentUuid": "6633c8e6_2fac8aee",
      "range": {
        "startLine": 669,
        "startChar": 16,
        "endLine": 669,
        "endChar": 27
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fb00f286_16307298",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 739,
      "author": {
        "id": 1060151
      },
      "writtenOn": "2021-02-10T01:25:52Z",
      "side": 1,
      "message": "A little off-topic, but should this be final so that children don\u0027t override it? It\u0027s not possible due to the override in ActiveBase, but I\u0027d love it if that could change.",
      "range": {
        "startLine": 739,
        "startChar": 8,
        "endLine": 739,
        "endChar": 14
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1b146689_a983d99c",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 739,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-11T07:37:54Z",
      "side": 1,
      "message": "per our conversation offline, making BaseState#processMessage final and merging ActiveBaseState\u0027s token check into isValidToken(token)\n\nAlso documenting that this is done to ensure the WakeLock is released",
      "parentUuid": "fb00f286_16307298",
      "range": {
        "startLine": 739,
        "startChar": 8,
        "endLine": 739,
        "endChar": 14
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "590bee71_07889813",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 879,
      "author": {
        "id": 1060151
      },
      "writtenOn": "2021-02-10T01:25:52Z",
      "side": 1,
      "message": "Yeah, and now I\u0027m scared. We can\u0027t make the BaseState processMessage() final, but we have to remember to release the WakeLock every time we override processMessage(), which is what I prefer not to do...",
      "range": {
        "startLine": 879,
        "startChar": 23,
        "endLine": 879,
        "endChar": 37
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9c4c3085_5057c536",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 879,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-11T07:37:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "590bee71_07889813",
      "range": {
        "startLine": 879,
        "startChar": 23,
        "endLine": 879,
        "endChar": 37
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "64c4576f_31341726",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 1677,
      "author": {
        "id": 1060151
      },
      "writtenOn": "2021-02-10T01:25:52Z",
      "side": 1,
      "message": "Since all this needs is a Context, why a VcnContext here? Testing?",
      "range": {
        "startLine": 1677,
        "startChar": 36,
        "endLine": 1677,
        "endChar": 46
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "22087dea_50c99ad8",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 1677,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-11T07:37:54Z",
      "side": 1,
      "message": "Felt weird to split the VcnContext -\u003e PowerManager process. Otherwise, we will get Context from VcnContext when calling Dependencies#newWakeLock, then get the SystemService from Context here\n\nVcnContext and Context are both mocked in testing",
      "parentUuid": "64c4576f_31341726",
      "range": {
        "startLine": 1677,
        "startChar": 36,
        "endLine": 1677,
        "endChar": 46
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "45518490_65566008",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 1677,
      "author": {
        "id": 1060151
      },
      "writtenOn": "2021-02-11T22:05:32Z",
      "side": 1,
      "message": "Generally you want to minimize the scope of inputs to a method (less cognitive load that way: the contract is clearer), but it\u0027s NBD. The extreme case of passing around the world is global scope. :)",
      "parentUuid": "22087dea_50c99ad8",
      "range": {
        "startLine": 1677,
        "startChar": 36,
        "endLine": 1677,
        "endChar": 46
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aec1a179_b0c981ce",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 1677,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-12T20:06:21Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "45518490_65566008",
      "range": {
        "startLine": 1677,
        "startChar": 36,
        "endLine": 1677,
        "endChar": 46
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0d5545b2_5c4de7cc",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 1684,
      "author": {
        "id": 1060151
      },
      "writtenOn": "2021-02-10T01:25:52Z",
      "side": 1,
      "message": "I don\u0027t believe this class ever used a version that\u0027s not refcounted. Perhaps YAGNI this out? Since we have an encapsulating class for test-ability anyway, might as well make use of it to just set this thing up the way we want as part of the constructor.",
      "range": {
        "startLine": 1684,
        "startChar": 20,
        "endLine": 1684,
        "endChar": 39
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2426cd67_67a0faef",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 15
      },
      "lineNbr": 1684,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-11T07:37:54Z",
      "side": 1,
      "message": "Was included for testing purposes. Combined with VcnWakeLock constructor",
      "parentUuid": "0d5545b2_5c4de7cc",
      "range": {
        "startLine": 1684,
        "startChar": 20,
        "endLine": 1684,
        "endChar": 39
      },
      "revId": "daf127e2a456af57c84aa9664f8d22fe724be652",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}