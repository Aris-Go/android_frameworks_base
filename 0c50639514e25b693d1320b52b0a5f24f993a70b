{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ae906eae_a664ca6b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1060907
      },
      "writtenOn": "2021-04-09T03:47:48Z",
      "side": 1,
      "message": "This is a work in progress, but I wanted to get some feedback on whether this whole approach is acceptable.\n\nNIAP requires that UNLOCKED_DEVICE_REQUIRED storage be *cryptographically* protected when the device is locked - that even given full knowledge of the state of the device including all memory, TEE keys etc, the only way to find the key to unlock it involves guessing the PIN/pattern/password until you guess correctly. However, if the device might be unlocked by a biometric, we have to ensure that a biometric auth token suffices to unlock it. This is incompatible with the NIAP requirement. The solution is that when we lock the device, we record whether biometric unlock has been disabled in the DPC, and we set up the means for a biometric-based unlock only if biometric unlock is not disabled. Thus users who require full NIAP compliance can disable biometric unlock in the DPC.",
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "206b1041_d5db916a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1059499
      },
      "writtenOn": "2021-04-13T10:53:00Z",
      "side": 1,
      "message": "Thinking about it a bit more, why should this capability dependent on an admin policy, instead of introducing a new type of key protection? Isn\u0027t it more flexible to support two type of lockscreen-protected keys, one unlockable via biometrics, and the other only via LSKF?",
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "433ee72d_578acd26",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1060907
      },
      "writtenOn": "2021-04-14T19:45:14Z",
      "side": 1,
      "message": "To my mind, the strength of UNLOCKED_DEVICE_REQUIRED is that the user doesn\u0027t have to think about it. If you\u0027re OK with the user sometimes needing to unlock explicitly, you might as well use an explicitly unlocked key. If you want keys that the user doesn\u0027t have to think about, but your compliance system also requires cryptographic-only unlock, disabling biometrics is the only way to achieve that. And if you have disabled biometrics anyway, you get the cryptographic security \"for free\".",
      "parentUuid": "206b1041_d5db916a",
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "196d7180_1a541ef0",
        "filename": "services/core/java/com/android/server/trust/TrustManagerService.java",
        "patchSetId": 1
      },
      "lineNbr": 1052,
      "author": {
        "id": 1060907
      },
      "writtenOn": "2021-04-09T03:47:48Z",
      "side": 1,
      "message": "\u003e Prefer to use mContext.getSystemService(DevicePolicyManager.class) instead to avoid the cast.\n\nPlease fix.",
      "parentUuid": "055eb540_93e0c37a",
      "range": {
        "startLine": 1052,
        "startChar": 16,
        "endLine": 1052,
        "endChar": 64
      },
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae58571e_e3d98fe8",
        "filename": "services/core/java/com/android/server/trust/TrustManagerService.java",
        "patchSetId": 1
      },
      "lineNbr": 1054,
      "author": {
        "id": 1059499
      },
      "writtenOn": "2021-04-12T14:17:59Z",
      "side": 1,
      "message": "What if this changes while the device is currently locked?",
      "range": {
        "startLine": 1054,
        "startChar": 31,
        "endLine": 1054,
        "endChar": 58
      },
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b2b6dbfd_5b9ee977",
        "filename": "services/core/java/com/android/server/trust/TrustManagerService.java",
        "patchSetId": 1
      },
      "lineNbr": 1054,
      "author": {
        "id": 1060907
      },
      "writtenOn": "2021-04-12T15:21:13Z",
      "side": 1,
      "message": "If it changes from biometrics disabled to biometrics enabled, there\u0027s nothing we can do until the next PIN unlock - we have cryptographically disabled the ability to unlock any other way. If it changes from biometrics enabled to biometrics disabled, I\u0027m OK with saying you don\u0027t get the security benefits of this feature until the next time the device is locked.",
      "parentUuid": "ae58571e_e3d98fe8",
      "range": {
        "startLine": 1054,
        "startChar": 31,
        "endLine": 1054,
        "endChar": 58
      },
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7fbe9033_96a66855",
        "filename": "services/core/java/com/android/server/trust/TrustManagerService.java",
        "patchSetId": 1
      },
      "lineNbr": 1054,
      "author": {
        "id": 1059499
      },
      "writtenOn": "2021-04-13T10:53:00Z",
      "side": 1,
      "message": "Act, can you mention this in the javadoc of setUnlockedDeviceRequired()?",
      "parentUuid": "b2b6dbfd_5b9ee977",
      "range": {
        "startLine": 1054,
        "startChar": 31,
        "endLine": 1054,
        "endChar": 58
      },
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "256d11d7_6c15e9a8",
        "filename": "services/core/java/com/android/server/trust/TrustManagerService.java",
        "patchSetId": 1
      },
      "lineNbr": 1054,
      "author": {
        "id": 1060907
      },
      "writtenOn": "2021-04-14T19:45:14Z",
      "side": 1,
      "message": "Will do!",
      "parentUuid": "7fbe9033_96a66855",
      "range": {
        "startLine": 1054,
        "startChar": 31,
        "endLine": 1054,
        "endChar": 58
      },
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d268c5bc_b549f209",
        "filename": "services/core/java/com/android/server/trust/TrustManagerService.java",
        "patchSetId": 1
      },
      "lineNbr": 1056,
      "author": {
        "id": 1059499
      },
      "writtenOn": "2021-04-12T14:17:59Z",
      "side": 1,
      "message": "Probably (disabled \u0026 DevicePolicyManager.KEYGUARD_DISABLE_BIOMETRICS) !\u003d 0 because DevicePolicyManager.KEYGUARD_DISABLE_BIOMETRICS is a combination of three individual biometric types, the admin might just disable the individual biometrics type applicable to the device.",
      "range": {
        "startLine": 1055,
        "startChar": 17,
        "endLine": 1056,
        "endChar": 70
      },
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e04a967b_989cf289",
        "filename": "services/core/java/com/android/server/trust/TrustManagerService.java",
        "patchSetId": 1
      },
      "lineNbr": 1056,
      "author": {
        "id": 1060907
      },
      "writtenOn": "2021-04-12T15:21:13Z",
      "side": 1,
      "message": "I\u0027m OK with saying that you only get the security benefits of this feature if you explicitly set DevicePolicyManager.KEYGUARD_DISABLE_BIOMETRICS. If you set some but not all of the bits, there might be an available biometric you\u0027ve left enabled, and in that case we don\u0027t want to turn this feature on.",
      "parentUuid": "d268c5bc_b549f209",
      "range": {
        "startLine": 1055,
        "startChar": 17,
        "endLine": 1056,
        "endChar": 70
      },
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ce855f2a_38625f38",
        "filename": "services/core/java/com/android/server/trust/TrustManagerService.java",
        "patchSetId": 1
      },
      "lineNbr": 1056,
      "author": {
        "id": 1059499
      },
      "writtenOn": "2021-04-13T10:53:00Z",
      "side": 1,
      "message": "OK, please document in setUnlockedDeviceRequired()\u0027s javadoc.",
      "parentUuid": "e04a967b_989cf289",
      "range": {
        "startLine": 1055,
        "startChar": 17,
        "endLine": 1056,
        "endChar": 70
      },
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "09b216b4_61eac2d5",
        "filename": "services/core/java/com/android/server/trust/TrustManagerService.java",
        "patchSetId": 1
      },
      "lineNbr": 1056,
      "author": {
        "id": 1060907
      },
      "writtenOn": "2021-04-14T19:45:14Z",
      "side": 1,
      "message": "Will do!",
      "parentUuid": "ce855f2a_38625f38",
      "range": {
        "startLine": 1055,
        "startChar": 17,
        "endLine": 1056,
        "endChar": 70
      },
      "revId": "0c50639514e25b693d1320b52b0a5f24f993a70b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}