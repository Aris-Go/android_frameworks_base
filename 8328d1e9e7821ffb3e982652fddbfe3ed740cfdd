{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "01aae82d_6bedcf69",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1381446
      },
      "writtenOn": "2023-06-15T01:15:22Z",
      "side": 1,
      "message": "Not sure I fully understand the issue here. What was not reset? IIUC, the visibility should be updated when the device went to sleep and resets the `mTopTurnScreenOnActivity` to null.",
      "range": {
        "startLine": 13,
        "startChar": 7,
        "endLine": 13,
        "endChar": 30
      },
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2e3a435b_d739c03f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 2012745
      },
      "writtenOn": "2023-06-15T06:43:34Z",
      "side": 1,
      "message": "The scenario is as follows: Device is in sleeping state and WhatsApp video call is received. \n1. In the WhatsApp video call activity startup flow, KeyguardController#updateVisibility() is called multiple times from RootWindowContainer#ensureActivitiesVisible()\n2. When app sets canTurnScreenOn, mTopTurnScreenOnActivity is assigned the top activity in line #627. But this time setShowWhenLocked flag is not yet set by app. So occludedByActivity is false hence wakeUp() is not called.\n3. Next time when KeyguardController#updateVisibility() is called, the lastTurnScreenOnActivity is assigned the same activity as mTopTurnScreenOnActivity in line #609, which is WhatsApp video call activity.\n4. Now in all further calls to KeyguardController#updateVisibility(), the condition on line #664 \"mTopTurnScreenOnActivity !\u003d lastTurnScreenOnActivity\" is never satisfied as both point to the same WhatsApp video call activity.\n5. So even though the app has setShowWhenLocked flag and occludedByActivity is true, the above condition in point 4. does not allow control to enter the if statement and wakeUp the screen.",
      "parentUuid": "01aae82d_6bedcf69",
      "range": {
        "startLine": 13,
        "startChar": 7,
        "endLine": 13,
        "endChar": 30
      },
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e06024ba_64be3525",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1977516
      },
      "writtenOn": "2023-06-15T17:09:28Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2e3a435b_d739c03f",
      "range": {
        "startLine": 13,
        "startChar": 7,
        "endLine": 13,
        "endChar": 30
      },
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "260a6f48_4feab4a6",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1045544
      },
      "writtenOn": "2023-06-16T12:58:20Z",
      "side": 1,
      "message": "Unresolving. Please let the discussion between Louis and Aditya finish.",
      "parentUuid": "e06024ba_64be3525",
      "range": {
        "startLine": 13,
        "startChar": 7,
        "endLine": 13,
        "endChar": 30
      },
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2d19065e_8cf6434b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1977516
      },
      "writtenOn": "2023-06-16T13:07:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "260a6f48_4feab4a6",
      "range": {
        "startLine": 13,
        "startChar": 7,
        "endLine": 13,
        "endChar": 30
      },
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c2edf6a0_cb3e2e36",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1977516
      },
      "writtenOn": "2023-06-16T13:11:23Z",
      "side": 1,
      "message": "letting the conversation between aditya and louis going \nso unresolving",
      "parentUuid": "2d19065e_8cf6434b",
      "range": {
        "startLine": 13,
        "startChar": 7,
        "endLine": 13,
        "endChar": 30
      },
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "606c7564_b1a616ce",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1045544
      },
      "writtenOn": "2023-06-16T13:18:04Z",
      "side": 1,
      "message": "Unresolved the correct comment thread.\n\n@louischang@google.com PTAL next week.",
      "parentUuid": "c2edf6a0_cb3e2e36",
      "range": {
        "startLine": 13,
        "startChar": 7,
        "endLine": 13,
        "endChar": 30
      },
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "17b91802_fb9348cd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1381446
      },
      "writtenOn": "2023-06-17T00:33:17Z",
      "side": 1,
      "message": "Thanks for the clarification!",
      "parentUuid": "606c7564_b1a616ce",
      "range": {
        "startLine": 13,
        "startChar": 7,
        "endLine": 13,
        "endChar": 30
      },
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d3cde84b_2f894664",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 2012745
      },
      "writtenOn": "2023-06-12T12:12:05Z",
      "side": 1,
      "message": "Please help to review and get it merged",
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5327d82_c4a178fd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1977516
      },
      "writtenOn": "2023-06-16T13:16:04Z",
      "side": 1,
      "message": "unresolved",
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4556f95b_745d6e0b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1045544
      },
      "writtenOn": "2023-06-16T13:18:04Z",
      "side": 1,
      "message": "closing empy comment thread.",
      "parentUuid": "b5327d82_c4a178fd",
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c2d0f3d0_9d5c50af",
        "filename": "services/core/java/com/android/server/wm/KeyguardController.java",
        "patchSetId": 1
      },
      "lineNbr": 666,
      "author": {
        "id": 1381446
      },
      "writtenOn": "2023-06-17T00:33:17Z",
      "side": 1,
      "message": "This would always be `true` when `mTopTurnScreenOnActivity` is non-null.\n\nHow about just removing the `mTopTurnScreenOnActivity !\u003d lastTurnScreenOnActivity` condition? Liks below:\n\n```\nif (mTopTurnScreenOnActivity !\u003d null\n    \u0026\u0026 !mService.mWindowManager.mPowerManager.isInteractive()\n    \u0026\u0026 (mRequestDismissKeyguard || occludedByActivity)) {\n```",
      "range": {
        "startLine": 666,
        "startChar": 23,
        "endLine": 666,
        "endChar": 78
      },
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b3a254e_7cc58e59",
        "filename": "services/core/java/com/android/server/wm/KeyguardController.java",
        "patchSetId": 1
      },
      "lineNbr": 666,
      "author": {
        "id": 2012745
      },
      "writtenOn": "2023-06-17T09:26:27Z",
      "side": 1,
      "message": "This seems fine too. I have uploaded a new patch set after removing the condition. Kindly review and get it merged.\nThanks!",
      "parentUuid": "c2d0f3d0_9d5c50af",
      "range": {
        "startLine": 666,
        "startChar": 23,
        "endLine": 666,
        "endChar": 78
      },
      "revId": "8328d1e9e7821ffb3e982652fddbfe3ed740cfdd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}