{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "aab0b340_bab4c70b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1604644
      },
      "writtenOn": "2024-08-06T06:30:46Z",
      "side": 1,
      "message": "There are corresponding definition in native layer: https://cs.android.com/android/platform/superproject/main/+/main:frameworks/av/media/ndk/NdkMediaFormat.cpp;drc\u003d6a7340064f2a27062fae7c96ad2391fcf84405c1;l\u003d374\nThis contribution adds corresponding definition in JAVA layer.\n\nThese two keys can be used for audio presentation selection before codec starts. The example usage is:\n\nMediaFormat trackFormat \u003d mediaExtractor.getTrackFormat(AUDIO_TRACK_AC4_INDEX);\nString mime \u003d trackFormat.getString(MediaFormat.KEY_MIME);\nmediaExtractor.selectTrack(AUDIO_TRACK_AC4_INDEX);\ntry {\n    MediaCodecList list \u003d new MediaCodecList(MediaCodecList.ALL_CODECS);\n    String name \u003d list.findDecoderForFormat(trackFormat);\n    decoder \u003d MediaCodec.createByCodecName(name);\n} catch (IOException e) {\n    throw new RuntimeException(e);\n}\n\nmAudioPresentations \u003d mediaExtractor.getAudioPresentations(AUDIO_TRACK_AC4_INDEX);\n\nmSelectedAudioPresentation \u003d mAudioPresentations.get(PREFERRED_PRESENTATION_INDEX);\nif (Build.VERSION.SDK_INT \u003e\u003d Build.VERSION_CODES.Q) {\n    trackFormat.setInteger(KEY_AUDIO_PRESENTATION_PRESENTATION_ID, mSelectedAudioPresentation.getPresentationId());\n    trackFormat.setInteger(KEY_AUDIO_PRESENTATION_PROGRAM_ID, mSelectedAudioPresentation.getProgramId());\n}\ndecoder.configure(trackFormat, null, null, 0);",
      "revId": "7b8b6982bb8d2dfb9c4a91af079d7d1a0c720cea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "25cd1c5a_19c70bef",
        "filename": "media/java/android/media/MediaFormat.java",
        "patchSetId": 1
      },
      "lineNbr": 1854,
      "author": {
        "id": 1643005
      },
      "writtenOn": "2024-08-06T08:48:20Z",
      "side": 1,
      "message": "further to what? I think it\u0027s implied that this is further to `KEY_AUDIO_PRESENTATION_PRESENTATION_ID` but imo we should make that connection explicit in the docs.\n\nRelated: What\u0027s expected if `KEY_AUDIO_PRESENTATION_PRESENTATION_ID` is not set, but `KEY_AUDIO_PRESENTATION_PROGRAM_ID` is?",
      "range": {
        "startLine": 1854,
        "startChar": 69,
        "endLine": 1854,
        "endChar": 76
      },
      "revId": "7b8b6982bb8d2dfb9c4a91af079d7d1a0c720cea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "af2768ac_8d4bbbba",
        "filename": "media/java/android/media/MediaFormat.java",
        "patchSetId": 1
      },
      "lineNbr": 1854,
      "author": {
        "id": 1604644
      },
      "writtenOn": "2024-08-07T02:11:31Z",
      "side": 1,
      "message": "For your first question, I just copied it from https://developer.android.com/reference/android/media/AudioPresentation?hl\u003den#getProgramId(). And I\u0027d like to provide some technical details for you.\nIn AC-4 decoder, there is a configuration to decide whether KEY_AUDIO_PRESENTATION_PRESENTATION_ID should be used when when KEY_AUDIO_PRESENTATION_PROGRAM_ID is matched with given program ID of the stream.\nIf the configuration is false, program ID will be ignored. If the configuration is true, presentation ID is only used when matched with given program ID of the stream. One typical use case for the latter is advertisement insertion.\n\nFor your second question, in theory, it should not be a case. But, if application actually does it as you said, (1) If the configuration in my first answer is false, the default presentation (usually the first presentation in the presentation list) will be selected for playback. (2) If that configuration is true, the default presentation will be selected only when the KEY_AUDIO_PRESENTATION_PROGRAM_ID setting is matched with given program ID of the stream.",
      "parentUuid": "25cd1c5a_19c70bef",
      "range": {
        "startLine": 1854,
        "startChar": 69,
        "endLine": 1854,
        "endChar": 76
      },
      "revId": "7b8b6982bb8d2dfb9c4a91af079d7d1a0c720cea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "48df321b_7d6dbd33",
        "filename": "media/java/android/media/MediaFormat.java",
        "patchSetId": 1
      },
      "lineNbr": 1854,
      "author": {
        "id": 1643005
      },
      "writtenOn": "2024-08-07T13:31:11Z",
      "side": 1,
      "message": "\u003e  I just copied it from https://developer.android.com/reference/android/media/AudioPresentation?hl\u003den#getProgramId()\n\nAh right, can we just link that from here after a short summary to avoid duplicating (and arguing about ðŸ˜Š) all the wording?\n\n```\nA key describing the program ID of {@link AudioPresentation}.\n\n\u003cp\u003eIf this key is not set, the default presentation will be used for audio playback.\n\n\u003cp\u003eSee also {@link AudioPresentation#getProgramId()}.\n```\n\nSame for the docs above too",
      "parentUuid": "af2768ac_8d4bbbba",
      "range": {
        "startLine": 1854,
        "startChar": 69,
        "endLine": 1854,
        "endChar": 76
      },
      "revId": "7b8b6982bb8d2dfb9c4a91af079d7d1a0c720cea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f51aa5c3_33813b4e",
        "filename": "media/java/android/media/MediaFormat.java",
        "patchSetId": 1
      },
      "lineNbr": 1854,
      "author": {
        "id": 1604644
      },
      "writtenOn": "2024-08-08T01:56:22Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "48df321b_7d6dbd33",
      "range": {
        "startLine": 1854,
        "startChar": 69,
        "endLine": 1854,
        "endChar": 76
      },
      "revId": "7b8b6982bb8d2dfb9c4a91af079d7d1a0c720cea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d4c1a01c_f4c3ca46",
        "filename": "media/java/android/media/MediaFormat.java",
        "patchSetId": 1
      },
      "lineNbr": 1854,
      "author": {
        "id": 1643005
      },
      "writtenOn": "2024-08-08T06:31:36Z",
      "side": 1,
      "message": "I\u0027m re-opening just to confirm my understanding of the second point:\n\n* Both set: non-default presentation may be used for audio playback\n* Either one, or neither, set: default presentation will be used for audio playback\n\ni.e. for either of these keys to have any effect, both must be set (in addition to the decoder-level config you mention above). Is that correct?",
      "parentUuid": "f51aa5c3_33813b4e",
      "range": {
        "startLine": 1854,
        "startChar": 69,
        "endLine": 1854,
        "endChar": 76
      },
      "revId": "7b8b6982bb8d2dfb9c4a91af079d7d1a0c720cea",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}