{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "afb83dcc_4e416d84",
        "filename": "media/jni/android_media_tv_Tuner.cpp",
        "patchSetId": 2
      },
      "lineNbr": 662,
      "author": {
        "id": 1608690
      },
      "writtenOn": "2022-04-20T17:34:47Z",
      "side": 1,
      "message": "I think this means this callback was called after the FilterCallback\u0027s destructor was called. This change is more like a workaround, and it has risk because FilterCallback has been destroyed.\n\nI think we should improve this part by two changes,\n1. In the HAL, I think ideally when closing the filter, the filter callbacks should be flushed before closing.\n2. Because the callback is oneway, in frameworks, we also need a mutex to ensure all callbacks are handled before destroy FilterCallback (we could add a mFilterCallback in to Filter to hold the FilterCallback and destroy it in FilterC\u0027s destructor).",
      "range": {
        "startLine": 657,
        "startChar": 0,
        "endLine": 662,
        "endChar": 5
      },
      "revId": "0efb027ca8e4937101e47df01b02354a0701883d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a42e558f_09ca2773",
        "filename": "media/jni/android_media_tv_Tuner.cpp",
        "patchSetId": 2
      },
      "lineNbr": 662,
      "author": {
        "id": 1889050
      },
      "writtenOn": "2022-04-22T13:10:07Z",
      "side": 1,
      "message": "1, In the tuner hal, it has ensured the FilterCallback is called before FilterCallback is destoryed;\n2,In Tuner framework, the FilterCallback is passed to tuner hal, tuner hal has ensured all callbacks are handles before FilterCallback is destroyed. so we don\u0027t think it needs to add a mutex in frameworks.",
      "parentUuid": "afb83dcc_4e416d84",
      "range": {
        "startLine": 657,
        "startChar": 0,
        "endLine": 662,
        "endChar": 5
      },
      "revId": "0efb027ca8e4937101e47df01b02354a0701883d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8eedfcc7_f18902bc",
        "filename": "media/jni/android_media_tv_Tuner.cpp",
        "patchSetId": 2
      },
      "lineNbr": 662,
      "author": {
        "id": 1608690
      },
      "writtenOn": "2022-04-22T17:25:28Z",
      "side": 1,
      "message": "As I said, the callback is \"oneway\", it may have some callbacks on the fly which have been sent out by HAL when you close the filter.\n\nAnd if your changes in HAL could fix this problem, why was this check in the FilterCallback still needed?",
      "parentUuid": "a42e558f_09ca2773",
      "range": {
        "startLine": 657,
        "startChar": 0,
        "endLine": 662,
        "endChar": 5
      },
      "revId": "0efb027ca8e4937101e47df01b02354a0701883d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}