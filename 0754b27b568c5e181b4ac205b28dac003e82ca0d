{
  "comments": [
    {
      "key": {
        "uuid": "d5d402cb_491bbcb9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2017-07-29T03:04:45Z",
      "side": 1,
      "message": "I don\u0027t understand this, and your bug doesn\u0027t give any real motivation. Why, exactly, can\u0027t libutils do what SystemProperties is doing and use regular infrastructure to watch for property updates? It basically makes zero sense as an API on SystemProperties.",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 0
      },
      "revId": "0754b27b568c5e181b4ac205b28dac003e82ca0d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8e38343c_660d5061",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2017-07-29T06:45:39Z",
      "side": 1,
      "message": "What do you mean by \u0027regular infrastructure\u0027? The way that sysprop updates are propagated is through binder; for process that only have Java binder threads, they need to call back into native code to let libutils know that a prop has been updated, since libutils is the one keeping track of the change callbacks.\n\nRegular binder does something similar, but it catches it earlier (before it ends up in Java):\n\nhttps://android.googlesource.com/platform/frameworks/base/+/master/core/jni/android_util_Binder.cpp#311\n\nThe rationale in context of the bug is that to be able to support tracing of HIDL HALs that run a server in Java, we need to be able to tell them a tracing prop has been updated. So, we send a regular SYSPROPS_TRANSACTION, and when our auto-generated code for HwBinder interfaces receives that, it calls SystemProperties.reportSyspropChanged(), which calls libutils, which in turn calls registered callbacks.",
      "parentUuid": "d5d402cb_491bbcb9",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 0
      },
      "revId": "0754b27b568c5e181b4ac205b28dac003e82ca0d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "83952983_c333b6ef",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2017-07-31T15:38:23Z",
      "side": 1,
      "message": "What I don\u0027t understand is why you need transactions to see the world state. Would __system_property_wait not work for you? The API is simply very strange for anyone who has worked with properties on a regular Java platform - why would I manually have to update properties that got changed somewhere else?",
      "parentUuid": "8e38343c_660d5061",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 0
      },
      "revId": "0754b27b568c5e181b4ac205b28dac003e82ca0d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9dddfece_9074253d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2017-07-31T16:25:08Z",
      "side": 1,
      "message": "It\u0027s definitely not the most convenient architecture.\n\nAll these processes are already waiting on binder \ntransactions, and report_sysprop_change will call all of the callbacks synchronously, so this will technically save you from creating a thread (that most likely won\u0027t be used) in all relevant processes.\n\n__system_property_wait also doesn\u0027t appear to give an efficient solution for waiting on a specific set of properties",
      "parentUuid": "83952983_c333b6ef",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 0
      },
      "revId": "0754b27b568c5e181b4ac205b28dac003e82ca0d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f6dca6fb_1c7d1688",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2017-07-31T18:18:26Z",
      "side": 1,
      "message": "Right - hanging up a thread in every process on __system_property_wait() isn\u0027t the greatest thing either, and the prop filtering options don\u0027t look great.\n\nPlatform/3P code really shouldn\u0027t call this API directly - but I didn\u0027t really find a more logical place to put it. If you know of a better place to put this code I\u0027m happy to move it.",
      "parentUuid": "9dddfece_9074253d",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 11,
        "endChar": 0
      },
      "revId": "0754b27b568c5e181b4ac205b28dac003e82ca0d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}