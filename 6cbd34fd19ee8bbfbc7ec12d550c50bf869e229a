{
  "comments": [
    {
      "key": {
        "uuid": "709c722a_ca157bf0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1041495
      },
      "writtenOn": "2015-04-16T15:28:25Z",
      "side": 1,
      "message": "I can\u0027t -- not a googler. :)\n\nIs there anything interesting on there (i.e. about the class/gl conflict), or just some benchmark numbers?",
      "range": {
        "startLine": 14,
        "startChar": 14,
        "endLine": 14,
        "endChar": 15
      },
      "revId": "6cbd34fd19ee8bbfbc7ec12d550c50bf869e229a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "907ac6a8_2c0439cf",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2015-04-16T16:23:05Z",
      "side": 1,
      "message": "\"Benchmark numbers,\" and guesses about the classes/GL conflict.\n\nI\u0027ve tried the combinations as indicated by the other CL, on a Nexus 6. Basically everything except starting OpenGL early reduced overall preloading time from ~1.6s to ~1.1s.",
      "parentUuid": "709c722a_ca157bf0",
      "range": {
        "startLine": 14,
        "startChar": 14,
        "endLine": 14,
        "endChar": 15
      },
      "revId": "6cbd34fd19ee8bbfbc7ec12d550c50bf869e229a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90a1e660_4bdf3155",
        "filename": "core/java/com/android/internal/os/ZygoteInit.java",
        "patchSetId": 1
      },
      "lineNbr": 195,
      "author": {
        "id": 1041495
      },
      "writtenOn": "2015-04-16T15:28:25Z",
      "side": 1,
      "message": "\u003e Thus starting class-preloading and OpenGL preloading at the same time has the potential for collision.\n\nMaybe I\u0027m missing something here, but the VM should definitely be able to handle several threads loading and initializing classes at the same time. So if that was your concern, I don\u0027t think you have to worry. If you meant something else, please educate me. :)",
      "revId": "6cbd34fd19ee8bbfbc7ec12d550c50bf869e229a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d080bec6_42ea9f74",
        "filename": "core/java/com/android/internal/os/ZygoteInit.java",
        "patchSetId": 1
      },
      "lineNbr": 195,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2015-04-16T16:23:05Z",
      "side": 1,
      "message": "EGL14 is initialized in both preloadClasses and preloadOpenGL. When preloadClasses is not multi-threaded, then there\u0027s the potential for overlap, and one may have to wait for the other. That was the only good reason (besides more I/O) that I was able to come up with for why in my experiments having all three started in parallel is worse than this scheme overall.",
      "parentUuid": "90a1e660_4bdf3155",
      "revId": "6cbd34fd19ee8bbfbc7ec12d550c50bf869e229a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90a1e660_eb14fdc7",
        "filename": "core/java/com/android/internal/os/ZygoteInit.java",
        "patchSetId": 1
      },
      "lineNbr": 195,
      "author": {
        "id": 1041495
      },
      "writtenOn": "2015-04-17T07:00:44Z",
      "side": 1,
      "message": "Okay, so no functional/stability difference. That\u0027s what I was wondering about -- thanks.",
      "parentUuid": "d080bec6_42ea9f74",
      "revId": "6cbd34fd19ee8bbfbc7ec12d550c50bf869e229a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90a1e660_6be0ed13",
        "filename": "core/java/com/android/internal/os/ZygoteInit.java",
        "patchSetId": 1
      },
      "lineNbr": 206,
      "author": {
        "id": 1041495
      },
      "writtenOn": "2015-04-16T15:28:25Z",
      "side": 1,
      "message": "Same theoretical issue as in https://android-review.googlesource.com/#/c/146951 -- if any classes preloaded classes (or their dependencies) are statically loading resources, we will have concurrent access issues in Resources. Again, I don\u0027t think this happens in practice.",
      "range": {
        "startLine": 206,
        "startChar": 12,
        "endLine": 206,
        "endChar": 28
      },
      "revId": "6cbd34fd19ee8bbfbc7ec12d550c50bf869e229a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "907ac6a8_0c629dbd",
        "filename": "core/java/com/android/internal/os/ZygoteInit.java",
        "patchSetId": 1
      },
      "lineNbr": 206,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2015-04-16T16:23:05Z",
      "side": 1,
      "message": "The only thing I could see was that semantics would be slightly changed - because of the global mPreloading flag, resources loaded would now go into the sPreloaded... structures instead of the caches. Otherwise I can\u0027t see concurrent access issues, honestly. Shouldn\u0027t the worst case be that you load a resource twice?",
      "parentUuid": "90a1e660_6be0ed13",
      "range": {
        "startLine": 206,
        "startChar": 12,
        "endLine": 206,
        "endChar": 28
      },
      "revId": "6cbd34fd19ee8bbfbc7ec12d550c50bf869e229a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90a1e660_0b1289d9",
        "filename": "core/java/com/android/internal/os/ZygoteInit.java",
        "patchSetId": 1
      },
      "lineNbr": 206,
      "author": {
        "id": 1041495
      },
      "writtenOn": "2015-04-17T07:00:44Z",
      "side": 1,
      "message": "AFAICT, there\u0027s no locking in the getDrawable -\u003e loadDrawable -\u003e cacheDrawable flow when preloading. We\u0027re adding stuff to the (non-concurrent-safe) sPreloaded* LongSparseArrays at https://android.googlesource.com/platform/frameworks/base/+/android-5.1.0_r5/core/java/android/content/res/Resources.java#2402\n\nThat spells trouble. The worst case is much worse than double-loading. Two concurrent put() calls could cause any of these problems, at least:\n\n* mSize is increased by 1 instead of 2\n* One of the puts is lost\n* ArrayIndexOutOfBoundsException\n* A put overwriting an old value (with a different key)\n* Probably more state corruption that could cause immediate or delayed problems.",
      "parentUuid": "907ac6a8_0c629dbd",
      "range": {
        "startLine": 206,
        "startChar": 12,
        "endLine": 206,
        "endChar": 28
      },
      "revId": "6cbd34fd19ee8bbfbc7ec12d550c50bf869e229a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}