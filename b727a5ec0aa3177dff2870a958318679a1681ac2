{
  "comments": [
    {
      "key": {
        "uuid": "b194f99e_bbd7487f",
        "filename": "services/core/java/com/android/server/accounts/AccountManagerService.java",
        "patchSetId": 2
      },
      "lineNbr": 5078,
      "author": {
        "id": 1059418
      },
      "writtenOn": "2017-10-25T18:15:14Z",
      "side": 1,
      "message": "I was wondering if you can check that the user is stopped before executing the query? E.g.:\n            public void run() {\n                synchronized (mUsers) {\n                    if (mUsers.get(userAccount.userId) \u003d\u003d null) {\n                        Slog.w(TAG, \"Cannot insert a log record accountId\u003d\" + accountId\n                                + \" action\u003d\" + action + \" tableName\u003d\" + tableName + \". User \"\n                                + userAccount.userId + \" is no longer running\");\n                        return;\n                    }\n                }",
      "range": {
        "startLine": 5078,
        "startChar": 16,
        "endLine": 5078,
        "endChar": 79
      },
      "revId": "b727a5ec0aa3177dff2870a958318679a1681ac2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4265ed37_0c62a80d",
        "filename": "services/core/java/com/android/server/accounts/AccountManagerService.java",
        "patchSetId": 2
      },
      "lineNbr": 5078,
      "author": {
        "id": 1235718
      },
      "writtenOn": "2017-10-26T03:00:41Z",
      "side": 1,
      "message": "Thanks! I will check it soon.",
      "parentUuid": "b194f99e_bbd7487f",
      "range": {
        "startLine": 5078,
        "startChar": 16,
        "endLine": 5078,
        "endChar": 79
      },
      "revId": "b727a5ec0aa3177dff2870a958318679a1681ac2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "59d6f443_d0cbc2bc",
        "filename": "services/core/java/com/android/server/accounts/AccountManagerService.java",
        "patchSetId": 2
      },
      "lineNbr": 5078,
      "author": {
        "id": 1235718
      },
      "writtenOn": "2017-10-26T07:55:09Z",
      "side": 1,
      "message": "Actually, the scenario can happen, if this implementation take into account it here, we need to implement sync operations b/w onStopUser \u0026 LogRecord to avoid \"TOCTOU\". (Because, there is no guarantee that onStopUser \u0026 LogRecord run on the same thread.)\n\nI think it\u0027s a bit complicated. So we implement this logic as exception catch, it\u0027s enough to avoid system crash.",
      "parentUuid": "4265ed37_0c62a80d",
      "range": {
        "startLine": 5078,
        "startChar": 16,
        "endLine": 5078,
        "endChar": 79
      },
      "revId": "b727a5ec0aa3177dff2870a958318679a1681ac2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}