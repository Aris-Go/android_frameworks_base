{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "11b737e1_59983e62",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1962615
      },
      "writtenOn": "2024-09-12T12:16:30Z",
      "side": 1,
      "message": "Please help review,thx!",
      "revId": "ed14dc8584509434c3d7032971efb14e12996ece",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9414b9b7_c944f3f3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1101746
      },
      "writtenOn": "2024-09-12T16:28:10Z",
      "side": 1,
      "message": "Thanks for reporting the issue and providing a patch to fix it.\n\nIt\u0027s likely that this will be overlooked in the future. Additionally, I don\u0027t think it\u0027s necessary to guard the profile owner details with the `ActivityManagerService` lock. Could you instead update `ActivityManagerService.setProfileOwnerUid()` and `ActivityManagerService.isProfileOwner()` to use `mProfileOwnerUids` as the lock ()? While you are making changes to that, if you could also update `ActivityManagerService.setCompanionAppUids()` and `ActivityManagerService.isAssociatedCompanionApp()` to use `mCompanionAppUidsMap` as the lock, that\u0027d be great.",
      "revId": "ed14dc8584509434c3d7032971efb14e12996ece",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "179cc3b7_83fd09e4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1962615
      },
      "writtenOn": "2024-09-13T13:56:13Z",
      "side": 1,
      "message": "09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: *** FATAL EXCEPTION IN SYSTEM PROCESS: main\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: java.lang.RuntimeException: Failed to create service com.android.server.devicepolicy.DevicePolicyManagerService$Lifecycle: service constructor threw an exception\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.SystemServiceManager.startService(SystemServiceManager.java:262)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.SystemServer.startOtherServices(SystemServer.java:2070)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.SystemServer.run(SystemServer.java:1032)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.SystemServer.main(SystemServer.java:727)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat java.lang.reflect.Method.invoke(Native Method)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:593)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:913)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: Caused by: java.lang.reflect.InvocationTargetException\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat java.lang.reflect.Constructor.newInstance0(Native Method)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat java.lang.reflect.Constructor.newInstance(Constructor.java:343)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.SystemServiceManager.startService(SystemServiceManager.java:251)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \t... 6 more\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: Caused by: java.lang.NullPointerException: Null reference used for synchronization (monitor-enter)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.am.ActivityManagerService$LocalService.setProfileOwnerUid(ActivityManagerService.java:20775)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.devicepolicy.Owners.pushToActivityManagerLocked(Owners.java:191)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.devicepolicy.Owners.notifyChangeLocked(Owners.java:145)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.devicepolicy.Owners.load(Owners.java:133)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.devicepolicy.DevicePolicyManagerService.loadOwners(DevicePolicyManagerService.java:2342)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.devicepolicy.DevicePolicyManagerService.\u003cinit\u003e(DevicePolicyManagerService.java:2142)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.devicepolicy.DevicePolicyManagerService.\u003cinit\u003e(DevicePolicyManagerService.java:2067)\n09-13 20:32:13.482  1000  2258  2258 E AndroidRuntime: \tat com.android.server.devicepolicy.DevicePolicyManagerService$Lifecycle.\u003cinit\u003e(DevicePolicyManagerService.java:1072)\n\nmProfileOwnerUids cannot be used as a lock in setProfileOwnerUid() because it has not been initialized at system startup. This will cause system_server to crash with the stack trace above. I will submit this again when I think it through.",
      "parentUuid": "9414b9b7_c944f3f3",
      "revId": "ed14dc8584509434c3d7032971efb14e12996ece",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b81b4174_8b37b6eb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1101746
      },
      "writtenOn": "2024-09-16T04:43:37Z",
      "side": 1,
      "message": "That\u0027s correct. We shouldn\u0027t be using non-final objects as locks. I uploaded a patch to reflect my earlier feedback.",
      "parentUuid": "179cc3b7_83fd09e4",
      "revId": "ed14dc8584509434c3d7032971efb14e12996ece",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}