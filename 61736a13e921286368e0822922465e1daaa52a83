{
  "comments": [
    {
      "key": {
        "uuid": "79cb06ca_22f6d019",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 5
      },
      "lineNbr": 1759,
      "author": {
        "id": 1071688
      },
      "writtenOn": "2017-08-08T14:09:50Z",
      "side": 1,
      "message": "Perhaps we should introduce a NetworkCapabilities.TRANSPORT_NONE?",
      "range": {
        "startLine": 1759,
        "startChar": 24,
        "endLine": 1759,
        "endChar": 26
      },
      "revId": "61736a13e921286368e0822922465e1daaa52a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b1959cf5_f6c9051c",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 5
      },
      "lineNbr": 1759,
      "author": {
        "id": 1107893
      },
      "writtenOn": "2017-08-09T00:39:35Z",
      "side": 1,
      "message": "That should not be needed. Outside of networking stack we would prefer if people used arrays of ints, in which case TRANSPORT_NONE is representable by an empty array.\n\nInside the NetworkCapabilities, we use a int bitmap flag, where TRANSPORT_NONE is 0 (no flag up).\n\nHere the issue you are having is because you are trying to think of a single transport. Instead this code should support multiple transports. I think VPN networks can already have multiple transports, and in the future this might be the case for new type of \"compound\" networks.\n\nI suggest to change int transport to either int[] transports (could be initially null or just an empty new int[]). Then you can to something like transport \u003d new int[] { NetworkCapabilities.TRANSPORT_CELLULAR } at line 1766.",
      "parentUuid": "79cb06ca_22f6d019",
      "range": {
        "startLine": 1759,
        "startChar": 24,
        "endLine": 1759,
        "endChar": 26
      },
      "revId": "61736a13e921286368e0822922465e1daaa52a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "975545b5_e4511e4f",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 5
      },
      "lineNbr": 1759,
      "author": {
        "id": 1071688
      },
      "writtenOn": "2017-08-09T11:58:28Z",
      "side": 1,
      "message": "Then I guess in line 1767 we would like to replace the \"else if\" with a \"if\".\n\nThis raises the question of what happens in the case of having both TRANSPORT_CELLULAR and TRANSPORT_WIFI. Which timeout should be used?",
      "parentUuid": "b1959cf5_f6c9051c",
      "range": {
        "startLine": 1759,
        "startChar": 24,
        "endLine": 1759,
        "endChar": 26
      },
      "revId": "61736a13e921286368e0822922465e1daaa52a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c9a4bd97_0ee7a5eb",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 5
      },
      "lineNbr": 1759,
      "author": {
        "id": 1071688
      },
      "writtenOn": "2017-08-09T12:06:49Z",
      "side": 1,
      "message": "Maybe we should call mNetd.addIdleTimer() several times, one for each transport?\n\nBut then it doesn\u0027t make sense because in the end this function is just executing iptables on an iface :-S",
      "parentUuid": "975545b5_e4511e4f",
      "range": {
        "startLine": 1759,
        "startChar": 24,
        "endLine": 1759,
        "endChar": 26
      },
      "revId": "61736a13e921286368e0822922465e1daaa52a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c2cf7803_4f2791b4",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 5
      },
      "lineNbr": 1759,
      "author": {
        "id": 1107893
      },
      "writtenOn": "2017-08-10T06:01:17Z",
      "side": 1,
      "message": "I would recommend a solution where addIdleTimer accept whatever NetworkCapabilities gives, so here this would be getTransportTypes() which return an int[]\n\nIn the future the case of CELL + WIFI will certainly happen. In that case for the timer it will either be the min of CELL and WIFI, or the max, whichever makes sense.\n\nAdding for one transport is an interesting idea. I don\u0027t know enough if this would work really.\n\nI would need to spend some time really understanding this code and its purpose to answer you, but I cannot afford to do this right now.",
      "parentUuid": "c9a4bd97_0ee7a5eb",
      "range": {
        "startLine": 1759,
        "startChar": 24,
        "endLine": 1759,
        "endChar": 26
      },
      "revId": "61736a13e921286368e0822922465e1daaa52a83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}