{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "438e09d0_ee199ca9",
        "filename": "core/java/android/provider/Settings.java",
        "patchSetId": 2
      },
      "lineNbr": 18156,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-14T16:20:52Z",
      "side": 1,
      "message": "Why should this data be kept in SettingsProvider; why not just use app data? What is your use case? Can the existing types of settings accommodate your usage?\n\nOn the other hand, does it mean that App A can see App B\u0027s setting as long as App A has READ_PACKAGE_SETTINGS permission? That means App A can know that App B is installed, which can violate the package visibility restriction.",
      "range": {
        "startLine": 18156,
        "startChar": 7,
        "endLine": 18156,
        "endChar": 67
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6adddd37_de55c86c",
        "filename": "core/java/android/provider/Settings.java",
        "patchSetId": 2
      },
      "lineNbr": 18156,
      "author": {
        "id": 2037182
      },
      "writtenOn": "2023-09-14T16:28:54Z",
      "side": 1,
      "message": "The main use case here is Notification Settings. Those are part of the device level settings, but should be set per package. In theory, one can use the system settings for this and create an abstraction on top of this to manage the keys per package. But that has the potential of duplicating this logic over and over again for other settings that are app specific, but on a device level.\nAs for the second question - this permission is a system permission. So only system apps can access it, not just any 3rd party app.",
      "parentUuid": "438e09d0_ee199ca9",
      "range": {
        "startLine": 18156,
        "startChar": 7,
        "endLine": 18156,
        "endChar": 67
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5d0cac24_b6dbe8a6",
        "filename": "core/java/android/provider/Settings.java",
        "patchSetId": 2
      },
      "lineNbr": 18156,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-14T17:51:54Z",
      "side": 1,
      "message": "I\u0027m still not very clear about the use cases. Currently system settings already has a notion of owning package (`setting.packageName`). What\u0027s the part of logic added in package settings that is currently missing in system settings? If there\u0027s such mismatch, can it be just be added to the existing system settings, instead of creating a new class?",
      "parentUuid": "6adddd37_de55c86c",
      "range": {
        "startLine": 18156,
        "startChar": 7,
        "endLine": 18156,
        "endChar": 67
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f125ec95_d37d5179",
        "filename": "core/java/android/provider/Settings.java",
        "patchSetId": 2
      },
      "lineNbr": 18156,
      "author": {
        "id": 1967850
      },
      "writtenOn": "2023-09-14T21:33:03Z",
      "side": 1,
      "message": "Song, long time no see :) I hope you are doing well. Say Hi to the team!\n\nHere is the doc we shared with G to see if we should upstream this work. Not sure who reviewed it on your side, but we got Okay to upstream. Maybe Pat has more context.\n\nhttps://docs.google.com/document/d/1NNXAlyBXDOZ9lRzAw6RoX0_vU3U3mQcRH_lf6uj572I/edit#heading\u003dh.th6i2dcguixt\n\nThe key use case is for the OS or trusted components (e.g, the Settings app) and putting settings per app. It is not for apps to store their state. Several AOSP systems roll their per user store - e.g. NotificationManagerService as Settings doesn\u0027t support that.\n\nIt is in the settings provider as it has the infra to store this, local caching, storage to disk, optimized to be loaded early before apps can run, etc. Think of this as the Settings.Secure but per-package.\n\nThe reason this is not folded in the settings.secure table is to allow separate security models (like DeviceConfig not folded in Settings.Secure) and also to avoid mixup of data from both worlds. Btw, we put privileged protection as a starting point which happens to be the same as the settings.secure table - this should be role based permission ideally.",
      "parentUuid": "5d0cac24_b6dbe8a6",
      "range": {
        "startLine": 18156,
        "startChar": 7,
        "endLine": 18156,
        "endChar": 67
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "53a169c5_619cdf9f",
        "filename": "core/java/android/provider/Settings.java",
        "patchSetId": 2
      },
      "lineNbr": 18156,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-15T18:43:26Z",
      "side": 1,
      "message": "Hi Svet, long time no see! Hope you are doing well, and thank you for still contributing to SettingsProvider! \n\nThanks for providing the context for this change. Given that this is mostly going to be used by system apps, I agree it makes more sense to not fold the new class in the existing Settings.Secure table.\n\nI\u0027ve requested access to read your doc. I will ask more questions there once I have access.",
      "parentUuid": "f125ec95_d37d5179",
      "range": {
        "startLine": 18156,
        "startChar": 7,
        "endLine": 18156,
        "endChar": 67
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e511f105_da66052a",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 3073,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-14T16:20:52Z",
      "side": 1,
      "message": "Iterating through the list of all the apps at boot can cause a significant delay if there are lots of packages installed. I see that you are already doing some cleaning up when a package is installed. Why is there still a need to do pruning during boot? Is it for system packages removed during OTA?",
      "range": {
        "startLine": 3073,
        "startChar": 21,
        "endLine": 3073,
        "endChar": 55
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "446f96b1_33aa371a",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 3073,
      "author": {
        "id": 2037182
      },
      "writtenOn": "2023-09-14T16:28:54Z",
      "side": 1,
      "message": "Exactly - OTA can change the list of apps. If there is a cleaner way to do this it would be good.",
      "parentUuid": "e511f105_da66052a",
      "range": {
        "startLine": 3073,
        "startChar": 21,
        "endLine": 3073,
        "endChar": 55
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f51cb612_b7c471bb",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 3073,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-14T17:51:54Z",
      "side": 1,
      "message": "In that case, you can call it under `mPackageManager.isDeviceUpgrading()`",
      "parentUuid": "446f96b1_33aa371a",
      "range": {
        "startLine": 3073,
        "startChar": 21,
        "endLine": 3073,
        "endChar": 55
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ed68fdcc_a6135db2",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 3073,
      "author": {
        "id": 1967850
      },
      "writtenOn": "2023-09-17T19:09:35Z",
      "side": 1,
      "message": "There was a PackageManagerInternal API we could use to efficiently iterate on the packages we can use as we are running in the system process.\n\nIt is not safe to do this only on upgrade - ex: package is uninstalled and before get the broadcast battery dies. Next time we boot we need to reconcile.",
      "parentUuid": "f51cb612_b7c471bb",
      "range": {
        "startLine": 3073,
        "startChar": 21,
        "endLine": 3073,
        "endChar": 55
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "58806d60_5a8f7285",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 3102,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-14T17:51:54Z",
      "side": 1,
      "message": "It might be more efficient to loop through the list of package names in `packageSettings.getSettingNamesLocked()` and check if the packages are still installed with `mPackageManager.getPackageUid` or `getPackageInfo`, instead of the other way around.",
      "range": {
        "startLine": 3081,
        "startChar": 16,
        "endLine": 3102,
        "endChar": 17
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1da6a720_7b4c4837",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 2
      },
      "lineNbr": 3122,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-14T17:51:54Z",
      "side": 1,
      "message": "`packageName + \"/\"` to be more precise (in case two packages start with the same string)",
      "range": {
        "startLine": 3122,
        "startChar": 40,
        "endLine": 3122,
        "endChar": 51
      },
      "revId": "177d23b958b643ce216d972c6c5756cdbb354781",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}