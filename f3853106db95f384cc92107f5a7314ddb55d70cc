{
  "comments": [
    {
      "key": {
        "uuid": "1cb6df40_53391dd0",
        "filename": "packages/Tethering/src/com/android/networkstack/tethering/BpfCoordinator.java",
        "patchSetId": 11
      },
      "lineNbr": 765,
      "author": {
        "id": 1308504
      },
      "writtenOn": "2020-06-16T11:04:13Z",
      "side": 1,
      "message": "If get mIpv6ForwardingRules is really necessary for testing but it won\u0027t use in tethering module itself, I would suggest to have a init method and override it in testing:\n\nIn BpfCoordinator.java\n    public BpfCoordinator(@NonNull Dependencies deps) {\n        mDeps \u003d deps;\n        mHandler \u003d mDeps.getHandler();\n        mNetd \u003d mDeps.getNetd();\n        mLog \u003d mDeps.getSharedLog().forSubComponent(TAG);\n+       mIpv6ForwardingRules \u003d NewForwardingRules();\n    }\n\n    public HashMap\u003cIpServer, LinkedHashMap\u003cInet6Address, Ipv6ForwardingRule\u003e\u003e initIpv6ForwardingRules() {\n        return new LinkedHashMap\u003c\u003e();\n    }\n\nIn BpfCorrdinatorTest.java\n    class MockBpfCoordinator extends BpfCoordinator {\n        public mIpv6ForwardingRulesForTesting;\n\n        @Override\n        public HashMap\u003cIpServer, LinkedHashMap\u003cInet6Address, Ipv6ForwardingRule\u003e\u003e initIpv6ForwardingRules() {\n            mIpv6ForwardingRulesForTesting \u003d super.initIpv6ForwardingRules();\n            return mIpv6ForwardingRulesForTesting;\n        }        \n    }\n\nThen you can use mIpv6ForwardingRulesForTesting from MockBpfCoordinator",
      "range": {
        "startLine": 758,
        "startChar": 0,
        "endLine": 765,
        "endChar": 5
      },
      "revId": "f3853106db95f384cc92107f5a7314ddb55d70cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e9987fa3_98bc920f",
        "filename": "packages/Tethering/src/com/android/networkstack/tethering/BpfCoordinator.java",
        "patchSetId": 11
      },
      "lineNbr": 765,
      "author": {
        "id": 1308504
      },
      "writtenOn": "2020-06-16T11:08:23Z",
      "side": 1,
      "message": "Ohh, sorry for typo.\nIn BpfCoordinator constructor.\nIt should be\n+       mIpv6ForwardingRules \u003d initIpv6ForwardingRules();",
      "parentUuid": "1cb6df40_53391dd0",
      "range": {
        "startLine": 758,
        "startChar": 0,
        "endLine": 765,
        "endChar": 5
      },
      "revId": "f3853106db95f384cc92107f5a7314ddb55d70cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8675e74a_d52a04c5",
        "filename": "packages/Tethering/src/com/android/networkstack/tethering/BpfCoordinator.java",
        "patchSetId": 11
      },
      "lineNbr": 765,
      "author": {
        "id": 1000835
      },
      "writtenOn": "2020-06-16T11:18:20Z",
      "side": 1,
      "message": "That would work too, though it\u0027s a bit strange for the code to rely on a dependencies object to create its own member variables. Either seems acceptable here.",
      "parentUuid": "e9987fa3_98bc920f",
      "range": {
        "startLine": 758,
        "startChar": 0,
        "endLine": 765,
        "endChar": 5
      },
      "revId": "f3853106db95f384cc92107f5a7314ddb55d70cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ccce2f2a_df13e6bc",
        "filename": "packages/Tethering/src/com/android/networkstack/tethering/BpfCoordinator.java",
        "patchSetId": 11
      },
      "lineNbr": 765,
      "author": {
        "id": 1348424
      },
      "writtenOn": "2020-06-17T06:02:44Z",
      "side": 1,
      "message": "Thanks for both of your comment. \n\nFor the limited time for release, I would like to keep current approach. Then, we could review if we really need to initialize the map in a dependencies object as mark\u0027s approach.",
      "parentUuid": "8675e74a_d52a04c5",
      "range": {
        "startLine": 758,
        "startChar": 0,
        "endLine": 765,
        "endChar": 5
      },
      "revId": "f3853106db95f384cc92107f5a7314ddb55d70cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5bf63909_d9494b24",
        "filename": "packages/Tethering/tests/unit/src/com/android/networkstack/tethering/BpfCoordinatorTest.java",
        "patchSetId": 11
      },
      "lineNbr": 545,
      "author": {
        "id": 1306837
      },
      "writtenOn": "2020-06-16T11:43:53Z",
      "side": 1,
      "message": "nit: IIUC this implies the above assertion is true. And if it fails with NPE we will know it if null.\nMaybe remove above line if feasible?\nNo strong opinion.",
      "range": {
        "startLine": 545,
        "startChar": 8,
        "endLine": 545,
        "endChar": 38
      },
      "revId": "f3853106db95f384cc92107f5a7314ddb55d70cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05e17089_9548f34d",
        "filename": "packages/Tethering/tests/unit/src/com/android/networkstack/tethering/BpfCoordinatorTest.java",
        "patchSetId": 11
      },
      "lineNbr": 545,
      "author": {
        "id": 1348424
      },
      "writtenOn": "2020-06-17T06:02:44Z",
      "side": 1,
      "message": "assertNotNull(rules) is a protection for fail case.\n\nIn fail case, |rules| may be a null pointer. \"rules.size()\" will raise an null pointer exception which crashes the test process. This null pointer check could help to avoid that and continue the remaining test cases.",
      "parentUuid": "5bf63909_d9494b24",
      "range": {
        "startLine": 545,
        "startChar": 8,
        "endLine": 545,
        "endChar": 38
      },
      "revId": "f3853106db95f384cc92107f5a7314ddb55d70cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7617d145_0f0eaae7",
        "filename": "packages/Tethering/tests/unit/src/com/android/networkstack/tethering/BpfCoordinatorTest.java",
        "patchSetId": 11
      },
      "lineNbr": 561,
      "author": {
        "id": 1306837
      },
      "writtenOn": "2020-06-16T11:43:53Z",
      "side": 1,
      "message": "Do you want to test if the config changes in runtime the coordinator still behaves well?\n true -\u003e false, false -\u003e true",
      "revId": "f3853106db95f384cc92107f5a7314ddb55d70cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05682304_e32eaa18",
        "filename": "packages/Tethering/tests/unit/src/com/android/networkstack/tethering/BpfCoordinatorTest.java",
        "patchSetId": 11
      },
      "lineNbr": 561,
      "author": {
        "id": 1348424
      },
      "writtenOn": "2020-06-17T06:02:44Z",
      "side": 1,
      "message": "noted.\nkeep this comment as unresolved. thanks for your advice.",
      "revId": "f3853106db95f384cc92107f5a7314ddb55d70cc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}