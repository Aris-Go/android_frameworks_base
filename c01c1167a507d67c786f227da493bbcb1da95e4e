{
  "comments": [
    {
      "key": {
        "uuid": "b6d576d5_70caa6f9",
        "filename": "core/java/android/os/BugreportManager.java",
        "patchSetId": 2
      },
      "lineNbr": 169,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2019-01-23T10:00:44Z",
      "side": 1,
      "message": "I think we shouldn\u0027t depend on the app calling cancelBugreport() to have the service shut down. In the worst case, an app could connect to the java service directly (instead of using this class), and start a bugreport but never call cancel(); this would leave the service around forever. Do you agree? One way to fix it could be to have the system_server instantiate its own listener, which can act as an intermediate between dumpstate and the app (ie when it receives a callback from the native service, it calls the same callback on the app listener). That can be a TODO, as I think we can implement it with the current API.",
      "range": {
        "startLine": 169,
        "startChar": 16,
        "endLine": 169,
        "endChar": 34
      },
      "revId": "c01c1167a507d67c786f227da493bbcb1da95e4e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fc3dab9c_5107c790",
        "filename": "core/java/android/os/BugreportManager.java",
        "patchSetId": 2
      },
      "lineNbr": 169,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2019-01-23T10:09:14Z",
      "side": 1,
      "message": "It\u0027s not true that only app calling cancelBugrport will shutdown the service. It\u0027s native service calling onFinished that will shutdown the service in the normal course (cancelBugreport is meant for user initiated cancel), and that should happen independent of the app\u0027s behavior as long as it goes through BugreportManager. But you are right, the app may directly call into system service, so we can add a listener there. I\u0027ll leave a TODO.\n\nDid I misread your comment?",
      "parentUuid": "b6d576d5_70caa6f9",
      "range": {
        "startLine": 169,
        "startChar": 16,
        "endLine": 169,
        "endChar": 34
      },
      "revId": "c01c1167a507d67c786f227da493bbcb1da95e4e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f033733a_79c499f4",
        "filename": "core/java/android/os/BugreportManager.java",
        "patchSetId": 2
      },
      "lineNbr": 169,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2019-01-23T10:18:38Z",
      "side": 1,
      "message": "Yeah what you describe is the scenario I worried about - you depend on this particular code being executed in the app process to clean up the native process. In general we try to avoid such dependencies. Adding a TODO sgtm.",
      "parentUuid": "fc3dab9c_5107c790",
      "range": {
        "startLine": 169,
        "startChar": 16,
        "endLine": 169,
        "endChar": 34
      },
      "revId": "c01c1167a507d67c786f227da493bbcb1da95e4e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}