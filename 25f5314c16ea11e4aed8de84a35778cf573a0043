{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "9b932b64_73075d4f",
        "filename": "core/java/android/provider/Settings.java",
        "patchSetId": 4
      },
      "lineNbr": 18183,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-18T22:57:07Z",
      "side": 1,
      "message": "`Package`",
      "range": {
        "startLine": 18183,
        "startChar": 16,
        "endLine": 18183,
        "endChar": 22
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "490562a8_764af91a",
        "filename": "core/java/android/provider/Settings.java",
        "patchSetId": 4
      },
      "lineNbr": 18183,
      "author": {
        "id": 2037182
      },
      "writtenOn": "2023-09-19T09:55:49Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "9b932b64_73075d4f",
      "range": {
        "startLine": 18183,
        "startChar": 16,
        "endLine": 18183,
        "endChar": 22
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f34998c1_e0fe3777",
        "filename": "core/java/android/provider/Settings.java",
        "patchSetId": 4
      },
      "lineNbr": 18300,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-18T22:57:07Z",
      "side": 1,
      "message": "nit: `createCompositeName`? This and below",
      "range": {
        "startLine": 18300,
        "startChar": 51,
        "endLine": 18300,
        "endChar": 75
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8768c0f9_7ddc0f46",
        "filename": "core/java/android/provider/Settings.java",
        "patchSetId": 4
      },
      "lineNbr": 18300,
      "author": {
        "id": 2037182
      },
      "writtenOn": "2023-09-19T09:55:49Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "f34998c1_e0fe3777",
      "range": {
        "startLine": 18300,
        "startChar": 51,
        "endLine": 18300,
        "endChar": 75
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6b940c16_518dbebe",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 2094,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-18T22:57:07Z",
      "side": 1,
      "message": "Can we not wrap it under `clearCallingIdentity`? Otherwise we can\u0027t properly check if the caller has package visibility to the target package",
      "range": {
        "startLine": 2085,
        "startChar": 8,
        "endLine": 2094,
        "endChar": 9
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "50108053_ba393fd6",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 2094,
      "author": {
        "id": 2037182
      },
      "writtenOn": "2023-09-19T09:55:49Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "6b940c16_518dbebe",
      "range": {
        "startLine": 2085,
        "startChar": 8,
        "endLine": 2094,
        "endChar": 9
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b170f836_aa75aa95",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 3085,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-18T22:57:07Z",
      "side": 1,
      "message": "Let\u0027s add a loop below this line to add package names to a `Set`, before looping through them and check if they are installed",
      "range": {
        "startLine": 3085,
        "startChar": 35,
        "endLine": 3085,
        "endChar": 40
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9e7b8a68_b4383363",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 3085,
      "author": {
        "id": 2037182
      },
      "writtenOn": "2023-09-19T09:55:49Z",
      "side": 1,
      "message": "I will need a map for this to work as I need to list all the setting names belonging to the package and iterate through them to remove them from the package settings. It might save some calls to getPackageInfo, but will definitely make the code harder to reason about.\nAs getPackageInfo implementation uses in memory cache, can I keep this implementation as is?",
      "parentUuid": "b170f836_aa75aa95",
      "range": {
        "startLine": 3085,
        "startChar": 35,
        "endLine": 3085,
        "endChar": 40
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5297ed0d_a2f85230",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 3085,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-19T17:07:53Z",
      "side": 1,
      "message": "These are direct calls to IPackageManager so there\u0027s no caching. You could do something like the following:\n\n```\nfinal List\u003cString\u003e names \u003d packageSettings.getSettingNamesLocked();\nfinal Set\u003cString\u003e uninstalledPackageNames \u003d new HashSet\u003c\u003e();\nfor (final String name : names) {\n    final String packageName \u003d name.split(\"/\")[0];\n    if (uninstalledPackageNames.contains(packageName)\n            || mPackageManager.getPackageInfo(packageName, 0, userId) \u003d\u003d null) {\n       uninstalledPackageNames.add(packageName);\n       if (packageSettings.deleteSettingLocked(name)) {\n           notifyChange \u003d true;\n       }\n    }\n}\n```\n\nBut it\u0027s a small optimization and I\u0027m fine leave the code as is for easier readability. (Of course it depends on how many settings there are that share same package names)",
      "parentUuid": "9e7b8a68_b4383363",
      "range": {
        "startLine": 3085,
        "startChar": 35,
        "endLine": 3085,
        "endChar": 40
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "159c3e98_63550a0a",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 3085,
      "author": {
        "id": 2037182
      },
      "writtenOn": "2023-09-20T10:25:32Z",
      "side": 1,
      "message": "Fair enough. Currently, the main use case is the NotificationsManager. Meaning that there will be very few settings per package, but that might change in the future. Will keep it simple for now.",
      "parentUuid": "5297ed0d_a2f85230",
      "range": {
        "startLine": 3085,
        "startChar": 35,
        "endLine": 3085,
        "endChar": 40
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5911d2c_941fc5c0",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 3107,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-18T22:57:07Z",
      "side": 1,
      "message": "nit: return early if `packageSettings \u003d\u003d null`",
      "range": {
        "startLine": 3107,
        "startChar": 11,
        "endLine": 3107,
        "endChar": 12
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ea703516_3992bfdc",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsProvider.java",
        "patchSetId": 4
      },
      "lineNbr": 3107,
      "author": {
        "id": 2037182
      },
      "writtenOn": "2023-09-19T09:55:49Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "c5911d2c_941fc5c0",
      "range": {
        "startLine": 3107,
        "startChar": 11,
        "endLine": 3107,
        "endChar": 12
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a20d5672_618deeb6",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsService.java",
        "patchSetId": 4
      },
      "lineNbr": 491,
      "author": {
        "id": 1480715
      },
      "writtenOn": "2023-09-18T22:57:07Z",
      "side": 1,
      "message": "`name of the package`",
      "range": {
        "startLine": 491,
        "startChar": 49,
        "endLine": 491,
        "endChar": 56
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "11585df2_6501aecd",
        "filename": "packages/SettingsProvider/src/com/android/providers/settings/SettingsService.java",
        "patchSetId": 4
      },
      "lineNbr": 491,
      "author": {
        "id": 2037182
      },
      "writtenOn": "2023-09-19T09:55:49Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "a20d5672_618deeb6",
      "range": {
        "startLine": 491,
        "startChar": 49,
        "endLine": 491,
        "endChar": 56
      },
      "revId": "25f5314c16ea11e4aed8de84a35778cf573a0043",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}