{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "fcaa8495_20effc4c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "Only real operative comment is the suggestion to reduce to one callback. The rest is just nits.",
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd88c571_41f1f0ea",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 216,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "\"could\" ? Does this mean this flag is advisory only, and the network might in fact not be blocked ? If that\u0027s true I think we may have a big problem – namely, how do we know if it really is blocked. If that\u0027s not true, then we should update the doc to explain that this is not just \"could be blocked\" but actually \"is blocked\".",
      "range": {
        "startLine": 216,
        "startChar": 82,
        "endLine": 216,
        "endChar": 87
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6147b581_1fad05e7",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 217,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "nit : being blocked ?",
      "range": {
        "startLine": 217,
        "startChar": 36,
        "endLine": 217,
        "endChar": 43
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e997b6dd_be818f42",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 281,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "Can you have some doc on what the ALLOWED_ constants mean ? Maybe you don\u0027t need to add doc for each, but at least the function these constants serve.",
      "range": {
        "startLine": 280,
        "startChar": 0,
        "endLine": 281,
        "endChar": 16
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "15854446_ae434732",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 288,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "maybe \"exempted\" ? \"allowlist\" is not a word and more importantly it is very very transparent what it\u0027s meant to replace, so it\u0027s not much better.",
      "range": {
        "startLine": 288,
        "startChar": 54,
        "endLine": 288,
        "endChar": 63
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "703decd6_d8ceac5c",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 304,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "I think you do need to list them here",
      "range": {
        "startLine": 304,
        "startChar": 4,
        "endLine": 304,
        "endChar": 6
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f649b685_d992cd0f",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 813,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "Nit : one would have to remember adding to this doc when adding a reason, which no tools will help them do. Suggest instead referencing the intdef, or simply saying \"a combination of the BLOCKED_REASON_* and/or BLOCKED_METERED_REASON_* constants\".",
      "range": {
        "startLine": 805,
        "startChar": 0,
        "endLine": 813,
        "endChar": 66
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "43e217ad_96cd398a",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 827,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "Supernit : if you remove this code the behavior is exactly the same, and bitmasks are one of the cheapest operations possible anyway so considering branch prediction this may in fact be slower on all code paths\n\nNot feeling strongly at all",
      "range": {
        "startLine": 825,
        "startChar": 0,
        "endLine": 827,
        "endChar": 9
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "86b76cae_075a5869",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 834,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "Likewise, you could just remove this mask (just test the value !\u003d NONE if meteredNetwork) and it would behave the same.\n\nAlso not feeling strongly at all`",
      "range": {
        "startLine": 834,
        "startChar": 35,
        "endLine": 834,
        "endChar": 65
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1374876c_f79615ce",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 871,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "This requires the callback to implement a sensible equals() method. That\u0027s fine, but it should be documented on the callback interface with the exact constraints on the method, and I think this method should also document that it will throw if already registered.",
      "range": {
        "startLine": 871,
        "startChar": 58,
        "endLine": 871,
        "endChar": 66
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "543df4a6_a0f6880c",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 912,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "From the documentation I struggle to figure out why we need both Status and Reason. It sounds to me like just Reason is enough – IIUC you will *always* call Reason when Status changes (even if the converse is not true).\n\nIf you want to avoid synchronous calls to isUidBlocked in response to onUidBlockedReasonChanged, maybe you can just add a boolean to onUidBlockedReasonChanged instead of having this different callback. If the client is interested in edges that change the blocked status, they can easily figure that out themselves from the arguments.",
      "range": {
        "startLine": 912,
        "startChar": 0,
        "endLine": 912,
        "endChar": 93
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "68fbc5ed_530c0944",
        "filename": "core/java/android/net/NetworkPolicyManager.java",
        "patchSetId": 7
      },
      "lineNbr": 958,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "This captures the callback and IIUC voids the point of using PooledLambda. See the doc at the top of PooledLambda.",
      "range": {
        "startLine": 958,
        "startChar": 57,
        "endLine": 958,
        "endChar": 65
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4cfec662_d0da0f94",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 7
      },
      "lineNbr": 58,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "Sorry if this is going to be a bit annoying, but considering that CS has isUidBlockedByVpn, I think it should use this as fully qualified rather than importing it so that it can highlight the difference.\n\nIf this was kotlin you could just import as some other name, but in Java you can\u0027t",
      "range": {
        "startLine": 58,
        "startChar": 47,
        "endLine": 58,
        "endChar": 59
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8eac18ae_96a71711",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 7
      },
      "lineNbr": 314,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "I think you want to at least keep the part of the old comment that says this must be accessed on the internal handler thread.",
      "range": {
        "startLine": 314,
        "startChar": 27,
        "endLine": 314,
        "endChar": 45
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "935ba441_98be8e90",
        "filename": "services/core/java/com/android/server/net/NetworkPolicyManagerService.java",
        "patchSetId": 7
      },
      "lineNbr": 434,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "Nit : we find it useful to document on the message what arguments it carries. Considering none of the other messages do that maybe it\u0027s not good here, but I still thought I\u0027d put it out there",
      "range": {
        "startLine": 434,
        "startChar": 29,
        "endLine": 434,
        "endChar": 55
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5405bac1_264bc845",
        "filename": "services/core/java/com/android/server/net/NetworkPolicyManagerService.java",
        "patchSetId": 7
      },
      "lineNbr": 3948,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "Not sure I understand this well, but can this be moved in the if() block above, on the assumption that it doesn\u0027t need to be done if the rule hasn\u0027t changed ? Same question in l.3969.",
      "range": {
        "startLine": 3948,
        "startChar": 12,
        "endLine": 3948,
        "endChar": 51
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f84b2d69_435a4f1f",
        "filename": "services/core/java/com/android/server/net/NetworkPolicyManagerService.java",
        "patchSetId": 7
      },
      "lineNbr": 4945,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "Can this even happen ? I think it\u0027s checked pretty early on.",
      "range": {
        "startLine": 4945,
        "startChar": 8,
        "endLine": 4945,
        "endChar": 31
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b14b6a5b_814f1684",
        "filename": "services/core/java/com/android/server/net/NetworkPolicyManagerService.java",
        "patchSetId": 7
      },
      "lineNbr": 5861,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "No strong opinion here, but I think it might be easier to read if you structured it the other way around :\n\n  effectiveBlockedReasons \u003d blockedReasons;\n  if (system) {\n    effective \u003d NONE;\n  }\n  if (ALLOWED_FOREGROUND) {\n    effective \u0026\u003d ~FOREGROUND_REASONS\n  }\n  if (ALLOWED_USER_EXEMPTED) {\n    effective \u0026\u003d ~USER_REASONS\n  }\n\n...probably not worth the time rewriting this code now that you already have it though",
      "range": {
        "startLine": 5861,
        "startChar": 13,
        "endLine": 5861,
        "endChar": 42
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c527f04e_7df2549a",
        "filename": "services/core/java/com/android/server/net/NetworkPolicyManagerService.java",
        "patchSetId": 7
      },
      "lineNbr": 5879,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "just \"allowed\" maybe ?",
      "range": {
        "startLine": 5879,
        "startChar": 44,
        "endLine": 5879,
        "endChar": 55
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8cf7cf7c_f895f179",
        "filename": "tests/net/java/com/android/server/ConnectivityServiceTest.java",
        "patchSetId": 7
      },
      "lineNbr": 1356,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-03-11T07:06:47Z",
      "side": 1,
      "message": "Suggest naming this \"setBlockedStatusChanged\" rather than \"invoke\" (similar to before)\n\nRationale : a setter is commonly understood to possibly have side effects like reaching out to the observers. A method called \"invoke\" doesn\u0027t look like it will have side effects on a member.",
      "range": {
        "startLine": 1356,
        "startChar": 17,
        "endLine": 1356,
        "endChar": 45
      },
      "revId": "ec0c3cb902db48de252c3ab1020a20372ad768ee",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}