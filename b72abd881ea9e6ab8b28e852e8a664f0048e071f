{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "170c9081_6c06e8dc",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 81,
      "author": {
        "id": 1783615
      },
      "writtenOn": "2021-03-19T05:13:46Z",
      "side": 1,
      "message": "It seems from the code that VBMETA_DIGEST_PROP_NAME and OTHER_VBMETA_DIGEST_PROP_NAME share similar purposes, but their differing docs raise some questions.\n - Is OTHER_VBMETA_DIGEST_PROP_NAME not available after boot?\n - Is VBMETA_DIGEST_PROP_NAME not set after an OTA update?",
      "range": {
        "startLine": 80,
        "startChar": 68,
        "endLine": 81,
        "endChar": 21
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5b7af95e_e8457b9b",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 81,
      "author": {
        "id": 1088085
      },
      "writtenOn": "2021-03-19T05:36:36Z",
      "side": 1,
      "message": "So ro.boot.vbmeta.digest is the vb digest of the current slot (slot a), it\u0027s always available.\n\nota.other.vbmeta_digest is the digest of slot b, it\u0027s only available after an OTA installs, but not yet reboots.\n\nAfter reboot, we expect to find ro.boot.vbmeta.digest \u003d\u003d stored ota.other.vbmeta_digest (slot b)\n\nOr ro.boot.vbmeta.digest \u003d\u003d stored ro.boot.vbmeta_digest (OTA failed and we falls back to slot a)\n\n\nIt\u0027s a different story for mainline update, b/c it won\u0027t change the slot.",
      "parentUuid": "170c9081_6c06e8dc",
      "range": {
        "startLine": 80,
        "startChar": 68,
        "endLine": 81,
        "endChar": 21
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2994349a_b6724830",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 81,
      "author": {
        "id": 1783615
      },
      "writtenOn": "2021-03-19T21:45:22Z",
      "side": 1,
      "message": "Talked a bit about this offline. This makes sense, but could use a comment on how the below keys are used to persist the metadata values so that they can be used for comparison after boot when these properties are not all accessible.",
      "parentUuid": "5b7af95e_e8457b9b",
      "range": {
        "startLine": 80,
        "startChar": 68,
        "endLine": 81,
        "endChar": 21
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5c5357c8_7f711545",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 81,
      "author": {
        "id": 1088085
      },
      "writtenOn": "2021-03-19T22:53:17Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "5b7af95e_e8457b9b",
      "range": {
        "startLine": 80,
        "startChar": 68,
        "endLine": 81,
        "endChar": 21
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "689d5d8f_dc9230fc",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 127,
      "author": {
        "id": 1286860
      },
      "writtenOn": "2021-03-18T23:54:26Z",
      "side": 1,
      "message": "Is there any way we could test the reported value of this ? Maybe even reading this field after reportMetricOnRestoreComplete in test ?",
      "range": {
        "startLine": 127,
        "startChar": 0,
        "endLine": 127,
        "endChar": 77
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2b87f82c_69e3d018",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 127,
      "author": {
        "id": 1088085
      },
      "writtenOn": "2021-03-19T00:03:33Z",
      "side": 1,
      "message": "you mean in unittest?",
      "parentUuid": "689d5d8f_dc9230fc",
      "range": {
        "startLine": 127,
        "startChar": 0,
        "endLine": 127,
        "endChar": 77
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f2cf16bb_342b1544",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 127,
      "author": {
        "id": 1286860
      },
      "writtenOn": "2021-03-19T00:12:39Z",
      "side": 1,
      "message": "Yes. Do we other tests that could verify this ?",
      "parentUuid": "2b87f82c_69e3d018",
      "range": {
        "startLine": 127,
        "startChar": 0,
        "endLine": 127,
        "endChar": 77
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2326e573_d1fdb1aa",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 127,
      "author": {
        "id": 1088085
      },
      "writtenOn": "2021-03-19T00:17:16Z",
      "side": 1,
      "message": "let me add a new test.. I think we can construct a failure case and match the exact error_code in reportMetrics. Will do in a followup",
      "parentUuid": "f2cf16bb_342b1544",
      "range": {
        "startLine": 127,
        "startChar": 0,
        "endLine": 127,
        "endChar": 77
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5ea6947c_8c328a96",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 127,
      "author": {
        "id": 1088085
      },
      "writtenOn": "2021-03-19T05:36:36Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "2326e573_d1fdb1aa",
      "range": {
        "startLine": 127,
        "startChar": 0,
        "endLine": 127,
        "endChar": 77
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0cf8ef9f_21cc9925",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 458,
      "author": {
        "id": 1783615
      },
      "writtenOn": "2021-03-19T05:13:46Z",
      "side": 1,
      "message": "Not sure this line has any effect ultimately since line 353 is the only call to getAndClearRebootEscrowKey. When null is returned from here, mLoadEscrowDataErrorCode is immediately set to ERROR_LOAD_ESCROW_KEY afterwards in 361, effectively masking this error code. No logging or metric reporting makes use of mLoadEscrowDataErrorCode in between these two places where it\u0027s set.",
      "range": {
        "startLine": 458,
        "startChar": 12,
        "endLine": 458,
        "endChar": 57
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1abd2ec5_d863ef76",
        "filename": "services/core/java/com/android/server/locksettings/RebootEscrowManager.java",
        "patchSetId": 8
      },
      "lineNbr": 458,
      "author": {
        "id": 1088085
      },
      "writtenOn": "2021-03-19T22:53:17Z",
      "side": 1,
      "message": "good point. Added a new function to only set the errorCode if unset.",
      "parentUuid": "0cf8ef9f_21cc9925",
      "range": {
        "startLine": 458,
        "startChar": 12,
        "endLine": 458,
        "endChar": 57
      },
      "revId": "b72abd881ea9e6ab8b28e852e8a664f0048e071f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}