{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "2e1f10dd_f7415bb7",
        "filename": "services/core/java/com/android/server/am/BatteryStatsService.java",
        "patchSetId": 8
      },
      "lineNbr": 118,
      "author": {
        "id": 1245797
      },
      "writtenOn": "2021-01-13T02:40:54Z",
      "side": 1,
      "message": "noteMobileRadioPowerState and noteWifiRadioPowerState are called by SystemApi\nhttps://source.corp.google.com/android/frameworks/base/core/java/android/os/BatteryStatsManager.java;rcl\u003df08ee5c1ee33829ada30d4ad5877e31255a62f68;l\u003d420\nAny call into those SystemApi via another process could easily break this claim.\n\nIf the intention is the replace those SystemApi, we should mark them as Deprecate, but we will need to continue supporting their functionality for 3 years.\n\nIn general, it would be very fragile design to rely on an external process/mainline module to enforce thread safety and I would suggest having the check/caching occur while holding the mLock or in the external process.\n\nIt\u0027s worth noting we already have a similar check inside the lock.\nhttps://source.corp.google.com/android/frameworks/base/core/java/com/android/internal/os/BatteryStatsImpl.java;rcl\u003d4a2427a05f71119771f978eb093ab324cdf5cdde;l\u003d5309",
      "range": {
        "startLine": 117,
        "startChar": 26,
        "endLine": 118,
        "endChar": 73
      },
      "revId": "5602e084ab1ffe37a0e413e0ea7413e9f0b2ff76",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2d556efe_d6b6ca5d",
        "filename": "services/core/java/com/android/server/am/BatteryStatsService.java",
        "patchSetId": 8
      },
      "lineNbr": 118,
      "author": {
        "id": 1304263
      },
      "writtenOn": "2021-01-13T06:33:48Z",
      "side": 1,
      "message": "Thanks for pointing out the issue. Theose systemApis are still needed(actually they\u0027re just opened for support this). I revise the design to put those two variable into mStat lock to ensure the thread safety, so the comment should not be needed now. Could you take another looks see if it works to you? Thanks.",
      "parentUuid": "2e1f10dd_f7415bb7",
      "range": {
        "startLine": 117,
        "startChar": 26,
        "endLine": 118,
        "endChar": 73
      },
      "revId": "5602e084ab1ffe37a0e413e0ea7413e9f0b2ff76",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}