{
  "comments": [
    {
      "key": {
        "uuid": "fcd45123_3d289aee",
        "filename": "services/core/java/com/android/server/connectivity/Tethering.java",
        "patchSetId": 9
      },
      "lineNbr": 1661,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2018-12-12T05:44:37Z",
      "side": 1,
      "message": "I am not a huge fan of this on two accounts :\n\n- Reacting to systemReady() means the system is not really ready. This is not an issue that you are introducing, but keeping the code running on systemReady() as small as possible is generally preferable.\n- This does not guarantee the issue goes away, it just makes it very unlikely.\n\n\nUnfortunately I don\u0027t have any brilliant idea to solve this issue. Ideally there would be a simple and clean way to start UNM just in time, and wait for it to be ready, but I don\u0027t see one right now.",
      "range": {
        "startLine": 1661,
        "startChar": 16,
        "endLine": 1661,
        "endChar": 27
      },
      "revId": "3f3503c66d050444d9d83e3b3c7703d8a43698c4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7177c7aa_6d0774de",
        "filename": "services/core/java/com/android/server/connectivity/Tethering.java",
        "patchSetId": 9
      },
      "lineNbr": 1661,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2018-12-12T06:41:49Z",
      "side": 1,
      "message": "Summing up what we discussed offline.\n\n- It\u0027s true that having system ready start stuff that will take time getting ready is an anti-pattern\n- It\u0027s true that this strictly speaking does not fix the race condition (it\u0027s still possible to query UNM for the status before UNM is ready\n\nHowever :\n\n- Fixing this race condition for good is a lot more complex than this simple fix.\n- The probability of the race happening with this design is vanishingly small.\n- The race condition already exists and this patch is not making it worse, only better.\n- Even when the race happens (they always do) the only concrete drawback is the device will perform a useless entitlement check. It will not use its result erroneously to deny tethering to a non-mobile upstream, the only drawback is one single useless entitlement check resulting in no user-visible issue.\n\n\nIn this situation, we agree this was probably a good tradeoff, fixing a large majority of the cases with a reasonably simple change, with the only (already existing anyway) drawback is not even user-visible and only costs a few bytes once.\n\nTherefore : we agreed to go with the design in this patchset.",
      "parentUuid": "fcd45123_3d289aee",
      "range": {
        "startLine": 1661,
        "startChar": 16,
        "endLine": 1661,
        "endChar": 27
      },
      "revId": "3f3503c66d050444d9d83e3b3c7703d8a43698c4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "847c4855_853d1e53",
        "filename": "services/core/java/com/android/server/connectivity/Tethering.java",
        "patchSetId": 9
      },
      "lineNbr": 1661,
      "author": {
        "id": 1308504
      },
      "writtenOn": "2018-12-12T06:55:13Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "7177c7aa_6d0774de",
      "range": {
        "startLine": 1661,
        "startChar": 16,
        "endLine": 1661,
        "endChar": 27
      },
      "revId": "3f3503c66d050444d9d83e3b3c7703d8a43698c4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "76d871bb_31de0a3e",
        "filename": "services/core/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitor.java",
        "patchSetId": 9
      },
      "lineNbr": 58,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2018-12-12T05:44:37Z",
      "side": 1,
      "message": "These are not callbacks right ? They are just methods to control the lifecycle of NetworkMonitor.",
      "range": {
        "startLine": 58,
        "startChar": 19,
        "endLine": 58,
        "endChar": 28
      },
      "revId": "3f3503c66d050444d9d83e3b3c7703d8a43698c4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "43cd6fd7_d6d9d220",
        "filename": "services/core/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitor.java",
        "patchSetId": 9
      },
      "lineNbr": 58,
      "author": {
        "id": 1308504
      },
      "writtenOn": "2018-12-12T06:55:13Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "76d871bb_31de0a3e",
      "range": {
        "startLine": 58,
        "startChar": 19,
        "endLine": 58,
        "endChar": 28
      },
      "revId": "3f3503c66d050444d9d83e3b3c7703d8a43698c4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6a7dc5d8_61538b04",
        "filename": "services/core/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitor.java",
        "patchSetId": 9
      },
      "lineNbr": 59,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2018-12-12T05:44:37Z",
      "side": 1,
      "message": "I am concerned that this requires the owner of UNM to manage the internal lifecycle details. Before this change, all the owner has to know is that UNM has to be started and stopped, which is not too much to ask of the caller. But with this, the caller has to know about all the internal details of UNM because it needs to tell it at the right time what to start monitor.\n\nI would much prefer if UNM offered more meaningful controls. For example, registerMobileNetworkRequest() exists because when the configuration requires it, Tethering needs to bring up a DUN network ; I think this would be expressed in a more meaningful way by having a method like \"setRequiresDun(boolean)\", and have UNM decide from that setting whether it\u0027s appropriate to file the request.\n\nLikewise, UNM needs to track the default network or all networks depending on whether the configuration says to latch to the default network or to use the priority list. The settings should probably reflect that.\n\nDo you think that\u0027s possible ?",
      "range": {
        "startLine": 59,
        "startChar": 42,
        "endLine": 59,
        "endChar": 47
      },
      "revId": "3f3503c66d050444d9d83e3b3c7703d8a43698c4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17f9ba71_c6e6c33a",
        "filename": "services/core/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitor.java",
        "patchSetId": 9
      },
      "lineNbr": 59,
      "author": {
        "id": 1308504
      },
      "writtenOn": "2018-12-12T06:55:13Z",
      "side": 1,
      "message": "As the discuss, I will refine this in the separate. Thanks your suggestion.",
      "parentUuid": "6a7dc5d8_61538b04",
      "range": {
        "startLine": 59,
        "startChar": 42,
        "endLine": 59,
        "endChar": 47
      },
      "revId": "3f3503c66d050444d9d83e3b3c7703d8a43698c4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5671bca6_720b0496",
        "filename": "services/core/java/com/android/server/connectivity/tethering/UpstreamNetworkMonitor.java",
        "patchSetId": 9
      },
      "lineNbr": 59,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2018-12-13T09:00:31Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "17f9ba71_c6e6c33a",
      "range": {
        "startLine": 59,
        "startChar": 42,
        "endLine": 59,
        "endChar": 47
      },
      "revId": "3f3503c66d050444d9d83e3b3c7703d8a43698c4",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}