{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "08d4b2cb_5674e03a",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 2
      },
      "lineNbr": 7259,
      "author": {
        "id": 1304263
      },
      "writtenOn": "2021-05-06T09:38:29Z",
      "side": 1,
      "message": "It will return false if the ranges are not exactly the same, even if the covered UIDs are for an equivalent result. In this case, I think it\u0027s accepttable to send another broadcast since it\u0027s intended to notify receiver to update its proxy data.",
      "range": {
        "startLine": 7259,
        "startChar": 70,
        "endLine": 7259,
        "endChar": 80
      },
      "revId": "e746554344f2af7a70133fefa8ff52ee7e62b27f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dcd6f1db_09a42840",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 2
      },
      "lineNbr": 7259,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-05-07T05:05:27Z",
      "side": 1,
      "message": "If prevNc is null and newNc has UIDs, the broadcast should be sent, but your code will not send it.\n\nSuggest having a helper method in NetworkCapabilities that takes 2 instances of Set\u003cUidRange\u003e that you could use here and it equalsUids().",
      "range": {
        "startLine": 7259,
        "startChar": 27,
        "endLine": 7259,
        "endChar": 58
      },
      "revId": "e746554344f2af7a70133fefa8ff52ee7e62b27f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5eb505fc_196c97e7",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 2
      },
      "lineNbr": 7259,
      "author": {
        "id": 1308163
      },
      "writtenOn": "2021-05-11T07:08:32Z",
      "side": 1,
      "message": "\u003e If prevNc is null and newNc has UIDs, the broadcast should be sent, but your code will not send it.\n\nFor the case of prevNc is null, I think it means that the network is just registered. And in fact, if the proxy is set, then the proxy broadcast will be sent when the VPN is CONNECTED. (updateNetworkInfo() -\u003e updateLinkProperties() -\u003e updateProxy())\nThat\u0027s why I didn\u0027t send the proxy broadcast for the case of prevNc is null.\nBut I think it\u0027s fine to send the proxy broadcast when prevNc is null here instead of relying on outside design.\n\n\u003e Suggest having a helper method in NetworkCapabilities that takes 2 instances of Set\u003cUidRange\u003e that you could use here and it equalsUids().\n\nDo you mean have a method like:\nboolean hasSameUids(Set\u003cUidRange\u003e r1, Set\u003cUidRange\u003e r2)?\nand use it here and equalsUids()?\nDoes it mean that we will move the logic from equalsUids() to the new function?\nIf so, I\u0027d like to keep the current design because I don\u0027t see any benefit of having a new function to do this.",
      "parentUuid": "dcd6f1db_09a42840",
      "range": {
        "startLine": 7259,
        "startChar": 27,
        "endLine": 7259,
        "endChar": 58
      },
      "revId": "e746554344f2af7a70133fefa8ff52ee7e62b27f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "61f98dcd_83cb48d5",
        "filename": "services/core/java/com/android/server/ConnectivityService.java",
        "patchSetId": 2
      },
      "lineNbr": 7259,
      "author": {
        "id": 1015428
      },
      "writtenOn": "2021-05-11T07:50:48Z",
      "side": 1,
      "message": "Your new code is a little bit more complex and doesn\u0027t take the prevNc !\u003d null \u0026 newNc \u003d\u003d null into account. Granted, this never happens, but from the point of view of this method a null NC codes for null UIDs, so I still think it would be better if it worked as expected even in this case that never happens in practice.\n\nYes, you are correct on the helper function. It could take Set\u003cUidRange\u003e or it could take NetworkCapabilities, either is fine. The benefit would be to have only one place to do the same null checks, or in other words you can call it without making a null check first. It\u0027s not very important.",
      "parentUuid": "5eb505fc_196c97e7",
      "range": {
        "startLine": 7259,
        "startChar": 27,
        "endLine": 7259,
        "endChar": 58
      },
      "revId": "e746554344f2af7a70133fefa8ff52ee7e62b27f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}