{
  "comments": [
    {
      "key": {
        "uuid": "e798bbaa_4f77b2d2",
        "filename": "packages/CaptivePortalLogin/src/com/android/captiveportallogin/CaptivePortalLoginActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 133,
      "author": {
        "id": 1000835
      },
      "writtenOn": "2017-06-19T03:22:13Z",
      "side": 1,
      "message": "How is this different than the previous code? registerNetworkCallback is void, and it either succeeds or throws an exception. ISTM that in both the new code and the previous code:\n\n- If it succeeds, mNetworkCallback is set.\n- If it throws, the app crashes.",
      "range": {
        "startLine": 132,
        "startChar": 0,
        "endLine": 133,
        "endChar": 99
      },
      "revId": "1a6e8646dc2fdc5883f072cd6bd12e63f005ad9d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "170146dc_8fe00498",
        "filename": "packages/CaptivePortalLogin/src/com/android/captiveportallogin/CaptivePortalLoginActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 474,
      "author": {
        "id": 1000835
      },
      "writtenOn": "2017-06-19T03:22:13Z",
      "side": 1,
      "message": "I don\u0027t think it\u0027s a good idea to have multiple codepaths unregister the callback. Can we do it in only one place? Given that the callback is registered in onCreate, onDestroy seems like the right place. So we should probably just remove it from done().",
      "range": {
        "startLine": 474,
        "startChar": 17,
        "endLine": 474,
        "endChar": 50
      },
      "revId": "1a6e8646dc2fdc5883f072cd6bd12e63f005ad9d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "35ca82bf_1a43a70b",
        "filename": "packages/CaptivePortalLogin/src/com/android/captiveportallogin/CaptivePortalLoginActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 474,
      "author": {
        "id": 1107893
      },
      "writtenOn": "2017-06-19T03:55:33Z",
      "side": 1,
      "message": "I hear your concern about still having potential paths to unregisterNetworkCallback, but I would like to point out that this might allow to achieve other guarantees more easily.\n\nFor instance onLost() calls done(), and if done() does not unregister the callback anymore, then we might be introducing new conditions in which done is called more than once.\n\nWill investigate more.",
      "parentUuid": "170146dc_8fe00498",
      "range": {
        "startLine": 474,
        "startChar": 17,
        "endLine": 474,
        "endChar": 50
      },
      "revId": "1a6e8646dc2fdc5883f072cd6bd12e63f005ad9d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "758a09e5_319f73df",
        "filename": "packages/CaptivePortalLogin/src/com/android/captiveportallogin/CaptivePortalLoginActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 474,
      "author": {
        "id": 1000835
      },
      "writtenOn": "2017-06-19T04:01:03Z",
      "side": 1,
      "message": "Done calls finishAndRemoveTask() which I think will cause onDestroy() to be called and the process to exist. In either case the callback will be unregistered by the system.",
      "parentUuid": "35ca82bf_1a43a70b",
      "range": {
        "startLine": 474,
        "startChar": 17,
        "endLine": 474,
        "endChar": 50
      },
      "revId": "1a6e8646dc2fdc5883f072cd6bd12e63f005ad9d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "22fb91d8_02df4933",
        "filename": "packages/CaptivePortalLogin/src/com/android/captiveportallogin/CaptivePortalLoginActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 474,
      "author": {
        "id": 1107893
      },
      "writtenOn": "2017-06-19T04:10:12Z",
      "side": 1,
      "message": "Yes it seems finishAndRemoveTask() eventually causes onDestroy() to be called, but documentation clearly says to not count on onDestroy() to actually do work.\n\nI agree to have a single call to unregisterNetworkCallback, and I think this should be in done().\n\nFurthermore, instead of protecting unregisterNetworkCallback against more than one calls, I would rather protect done() against more than one calls.",
      "parentUuid": "758a09e5_319f73df",
      "range": {
        "startLine": 474,
        "startChar": 17,
        "endLine": 474,
        "endChar": 50
      },
      "revId": "1a6e8646dc2fdc5883f072cd6bd12e63f005ad9d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1be39e1d_e5ac71a4",
        "filename": "packages/CaptivePortalLogin/src/com/android/captiveportallogin/CaptivePortalLoginActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 474,
      "author": {
        "id": 1107893
      },
      "writtenOn": "2017-06-19T05:11:42Z",
      "side": 1,
      "message": "From offline discussion, we decided to leave the one call to unregisterNetworkCallback in onDestroy to avoid leaks in situation like orientation changes.\n\nIn addition done() must be protected from multiple calls anyway.",
      "parentUuid": "22fb91d8_02df4933",
      "range": {
        "startLine": 474,
        "startChar": 17,
        "endLine": 474,
        "endChar": 50
      },
      "revId": "1a6e8646dc2fdc5883f072cd6bd12e63f005ad9d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}