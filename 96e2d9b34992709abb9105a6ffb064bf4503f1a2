{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "b42b3fe4_705823f4",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 435,
      "author": {
        "id": 1221725
      },
      "writtenOn": "2021-02-04T05:42:44Z",
      "side": 1,
      "message": "Can we also add a comment noting how this intends to handle delayed messages?",
      "range": {
        "startLine": 435,
        "startChar": 82,
        "endLine": 435,
        "endChar": 83
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "639862dd_d86780ee",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 435,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-05T01:10:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b42b3fe4_705823f4",
      "range": {
        "startLine": 435,
        "startChar": 82,
        "endLine": 435,
        "endChar": 83
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee658df8_126f5e32",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 656,
      "author": {
        "id": 1221725
      },
      "writtenOn": "2021-02-04T05:42:44Z",
      "side": 1,
      "message": "Can this ever get queued after the state machine has shut down? ie, we obtain one without ever releasing?",
      "range": {
        "startLine": 656,
        "startChar": 8,
        "endLine": 656,
        "endChar": 97
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "df347444_1d8b21bf",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 656,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-05T01:10:23Z",
      "side": 1,
      "message": "This should be handled in theory by onQuitting() releasing the WakeLock, but will wrap this in an additional check to isRunning to be safe - thoughts?",
      "parentUuid": "ee658df8_126f5e32",
      "range": {
        "startLine": 656,
        "startChar": 8,
        "endLine": 656,
        "endChar": 97
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a9351d3f_9cb87453",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 656,
      "author": {
        "id": 1221725
      },
      "writtenOn": "2021-02-05T07:54:25Z",
      "side": 1,
      "message": "Yep, checking isRunning was exactly what I was thinking. My worry was if UnderlyingNetworkTracker fired a callback after the state machine had shut down; we\u0027d grab the wake lock without a corresponding release upon StateMachine shutdown.",
      "parentUuid": "df347444_1d8b21bf",
      "range": {
        "startLine": 656,
        "startChar": 8,
        "endLine": 656,
        "endChar": 97
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f62873f2_470be1c1",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 661,
      "author": {
        "id": 1221725
      },
      "writtenOn": "2021-02-04T05:42:44Z",
      "side": 1,
      "message": "Suggest just using the \"VcnGatwayConnection\" tag; it\u0027s a bit more trackable.",
      "range": {
        "startLine": 661,
        "startChar": 77,
        "endLine": 661,
        "endChar": 90
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "03a063c6_dd5e4736",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 661,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-05T01:10:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f62873f2_470be1c1",
      "range": {
        "startLine": 661,
        "startChar": 77,
        "endLine": 661,
        "endChar": 90
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d595bb5b_0eb38a31",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 673,
      "author": {
        "id": 1221725
      },
      "writtenOn": "2021-02-04T05:42:44Z",
      "side": 1,
      "message": "I **think** you can re-acquire wakelocks that have been released, and construct a wakelock without needing to acquire. Perhaps we keep one for the life of the session?",
      "range": {
        "startLine": 673,
        "startChar": 16,
        "endLine": 673,
        "endChar": 33
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "efe2fecc_c99b7442",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 673,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-05T01:10:23Z",
      "side": 1,
      "message": "Makes sense - changed to get a single WakeLock on construction. Added testing to verify this in VcnGatewayConnectionTest.\n\nDone",
      "parentUuid": "d595bb5b_0eb38a31",
      "range": {
        "startLine": 673,
        "startChar": 16,
        "endLine": 673,
        "endChar": 33
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b1459bc8_4ad652da",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 691,
      "author": {
        "id": 1221725
      },
      "writtenOn": "2021-02-04T05:42:44Z",
      "side": 1,
      "message": "If we\u0027re locking and considering multi-threaded operation, the condition and the wakelock should both be synchronized. Else we could get a case where two conditions are met, and both perform wakelock operations in the wrong order:\n\n                 \u003c-- hasMessageOrCallbacks()\nobtainWakelock() --\u003e\n                 \u003c-- releaseWakelock()\nsendMessage()    --\u003e\n\nThat said, I am actually starting to feel like the locking is causing more cognitive overhead than it\u0027s worth. We\u0027re relying heavily on the single-threaded approach, and it\u0027ll be hard to make sure the locking is correct. (and if it isn\u0027t correct, it gives us a false sense of security, which is worse).\n\nSuggest maybe we remove the locks, and add ensureRunningOnLooperThread() calls to incoming calls.",
      "range": {
        "startLine": 690,
        "startChar": 0,
        "endLine": 691,
        "endChar": 51
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8bdd6492_14d5c93a",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 691,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-05T01:10:23Z",
      "side": 1,
      "message": "Added ensureOnLooper() checks for all incoming methods. Also added to obtain/release WakeLock methods to be safe.\n\nDone",
      "parentUuid": "b1459bc8_4ad652da",
      "range": {
        "startLine": 690,
        "startChar": 0,
        "endLine": 691,
        "endChar": 51
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "88d68b2e_9928e8aa",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 760,
      "author": {
        "id": 1221725
      },
      "writtenOn": "2021-02-04T05:42:44Z",
      "side": 1,
      "message": "Could we add a comment that getHandler() cannot be null here; since it\u0027s actively processing a state?\n\n(if it\u0027s not actively processing, getHandler() can be null...)",
      "range": {
        "startLine": 760,
        "startChar": 17,
        "endLine": 760,
        "endChar": 29
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "570361a9_0ecd0542",
        "filename": "services/core/java/com/android/server/vcn/VcnGatewayConnection.java",
        "patchSetId": 5
      },
      "lineNbr": 760,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-05T01:10:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "88d68b2e_9928e8aa",
      "range": {
        "startLine": 760,
        "startChar": 17,
        "endLine": 760,
        "endChar": 29
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7ae65804_57e3cc6e",
        "filename": "tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionTestBase.java",
        "patchSetId": 5
      },
      "lineNbr": 164,
      "author": {
        "id": 1221725
      },
      "writtenOn": "2021-02-04T05:42:44Z",
      "side": 1,
      "message": "Acquired?",
      "range": {
        "startLine": 164,
        "startChar": 33,
        "endLine": 164,
        "endChar": 41
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "10cde93d_7ca72359",
        "filename": "tests/vcn/java/com/android/server/vcn/VcnGatewayConnectionTestBase.java",
        "patchSetId": 5
      },
      "lineNbr": 164,
      "author": {
        "id": 1463964
      },
      "writtenOn": "2021-02-05T01:10:23Z",
      "side": 1,
      "message": "previously used \u0027obtained\u0027 to match the util method in VcnGatewayConnection (#obtainWakeLock). Changed both to use \u0027acquire\u0027\n\nDone",
      "parentUuid": "7ae65804_57e3cc6e",
      "range": {
        "startLine": 164,
        "startChar": 33,
        "endLine": 164,
        "endChar": 41
      },
      "revId": "96e2d9b34992709abb9105a6ffb064bf4503f1a2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}