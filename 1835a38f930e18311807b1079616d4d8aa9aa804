{
  "comments": [
    {
      "key": {
        "uuid": "8fbfe18b_fdc6ef55",
        "filename": "core/java/android/app/ActivityThread.java",
        "patchSetId": 1
      },
      "lineNbr": 746,
      "author": {
        "id": 1000559
      },
      "writtenOn": "2014-02-11T22:56:22Z",
      "side": 1,
      "message": "Are you sure you want to pass in package name here?  Note that when multiple applications run in one process, it is essentially arbitrary which of those will appear first, making the package name questionable.  I would really prefer that when we are dealing with processes we stick only to process names to avoid such ambiguity.",
      "revId": "1835a38f930e18311807b1079616d4d8aa9aa804",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4f3ec9eb_85374613",
        "filename": "core/java/android/app/ActivityThread.java",
        "patchSetId": 1
      },
      "lineNbr": 746,
      "author": {
        "id": 1036486
      },
      "writtenOn": "2014-02-11T23:07:22Z",
      "side": 1,
      "message": "The issue is that we need to create a single profile file for an apk because dex2oat is run once on an apk by installd.  There may be multiple processes running using the same apk, and therefore the same profile file.  Each processes needs to know the profile file name (or be able to derive it) in order to read/write it.  The reason for installd creating the profile file is security.  It used to be in the /data/data directory but dex2oat can\u0027t read it (selinux config).\n\nI understand your point about multiple packages in one process though.  Have to figure out how to deal with that one...",
      "parentUuid": "8fbfe18b_fdc6ef55",
      "revId": "1835a38f930e18311807b1079616d4d8aa9aa804",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "efce9d4a_068fee62",
        "filename": "core/java/android/app/ActivityThread.java",
        "patchSetId": 1
      },
      "lineNbr": 746,
      "author": {
        "id": 1000559
      },
      "writtenOn": "2014-02-12T00:11:46Z",
      "side": 1,
      "message": "It seems to me this needs to be done for each app that is loaded into the process, not at the initial bind point?  I\u0027m not sure what this function is intended to do, but the fact that it is passing in a data dir for the first app in and using that for the whole process is the same problem.  If there is something that is set up with app-specific data like the package name or data dir, it probably be done somewhere like the includeCode path of getPackageInfo(), where we actually load each app\u0027s code in to the process.",
      "parentUuid": "4f3ec9eb_85374613",
      "revId": "1835a38f930e18311807b1079616d4d8aa9aa804",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8fbfe18b_98482149",
        "filename": "core/java/android/app/ActivityThread.java",
        "patchSetId": 1
      },
      "lineNbr": 746,
      "author": {
        "id": 1036486
      },
      "writtenOn": "2014-02-12T00:35:53Z",
      "side": 1,
      "message": "I think you are on to something.  I was not aware that a process can contain more than one application.  Is there an ActivityThread for each one?  The data dir is not actually used in this current version of the code but I get your point.\n\nI guess that if the registerAppInfo() is called for each activity thread then there also needs to be a profiler for each application, or an application-aware profiler.   At the moment I only have one profiler thread per process and that is passed one identifier for the profile file.\n\nI will need to rethink this...",
      "parentUuid": "efce9d4a_068fee62",
      "revId": "1835a38f930e18311807b1079616d4d8aa9aa804",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf62b923_d398f4aa",
        "filename": "core/java/android/app/ActivityThread.java",
        "patchSetId": 1
      },
      "lineNbr": 746,
      "author": {
        "id": 1036486
      },
      "writtenOn": "2014-02-12T01:21:53Z",
      "side": 1,
      "message": "I talked to the team.  We are going to detect the case where the user wants to run two applications in the same process and switch off profiling if found.  Brian added some code to do something similar for Thread.setContextClassLoader().  I will use similar code to elide the call to registerAppInfo() and therefore prevent the profiler from starting.  That should solve this case.",
      "parentUuid": "8fbfe18b_98482149",
      "revId": "1835a38f930e18311807b1079616d4d8aa9aa804",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "efce9d4a_9b481749",
        "filename": "core/jni/AndroidRuntime.cpp",
        "patchSetId": 1
      },
      "lineNbr": 769,
      "author": {
        "id": 1018083
      },
      "writtenOn": "2014-02-11T22:43:48Z",
      "side": 1,
      "message": "Are these in milliseconds or seconds?\n\nmaybe user can provide units (1ms, 500us, 1s)",
      "range": {
        "startLine": 767,
        "startChar": 0,
        "endLine": 769,
        "endChar": 72
      },
      "revId": "1835a38f930e18311807b1079616d4d8aa9aa804",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf26394f_02a19445",
        "filename": "core/jni/AndroidRuntime.cpp",
        "patchSetId": 1
      },
      "lineNbr": 769,
      "author": {
        "id": 1036486
      },
      "writtenOn": "2014-02-18T20:53:53Z",
      "side": 1,
      "message": "Allowing users to provide units would have the potential of putting these values out of reasonable ranges.  I would prefer to add the units as a suffix to the property (e.g. dalvik.vm.profile.period_secs).  The user is very unlikely to be setting the command line options manually unless they are running the dalvikvm command.",
      "parentUuid": "efce9d4a_9b481749",
      "range": {
        "startLine": 767,
        "startChar": 0,
        "endLine": 769,
        "endChar": 72
      },
      "revId": "1835a38f930e18311807b1079616d4d8aa9aa804",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "efce9d4a_5bb62fe3",
        "filename": "services/java/com/android/server/pm/Installer.java",
        "patchSetId": 1
      },
      "lineNbr": 204,
      "author": {
        "id": 1003723
      },
      "writtenOn": "2014-02-11T22:49:05Z",
      "side": 1,
      "message": "is this version still used?",
      "range": {
        "startLine": 204,
        "startChar": 4,
        "endLine": 204,
        "endChar": 66
      },
      "revId": "1835a38f930e18311807b1079616d4d8aa9aa804",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf26394f_e28498b4",
        "filename": "services/java/com/android/server/pm/Installer.java",
        "patchSetId": 1
      },
      "lineNbr": 204,
      "author": {
        "id": 1036486
      },
      "writtenOn": "2014-02-18T20:53:53Z",
      "side": 1,
      "message": "Yes, it\u0027s used for libraries where we don\u0027t have a package name.",
      "parentUuid": "efce9d4a_5bb62fe3",
      "range": {
        "startLine": 204,
        "startChar": 4,
        "endLine": 204,
        "endChar": 66
      },
      "revId": "1835a38f930e18311807b1079616d4d8aa9aa804",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}