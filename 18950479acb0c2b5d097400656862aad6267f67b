{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "bbb950f6_25a8e57e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 18,
      "author": {
        "id": 1381446
      },
      "writtenOn": "2024-10-14T04:19:12Z",
      "side": 1,
      "message": "Please remove the internal branch name from AOSP.",
      "range": {
        "startLine": 18,
        "startChar": 5,
        "endLine": 18,
        "endChar": 34
      },
      "revId": "18950479acb0c2b5d097400656862aad6267f67b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "07ef1695_1338398f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 18,
      "author": {
        "id": 1564515
      },
      "writtenOn": "2024-10-14T04:44:15Z",
      "side": 1,
      "message": "Oh, I see. Removed.",
      "parentUuid": "bbb950f6_25a8e57e",
      "range": {
        "startLine": 18,
        "startChar": 5,
        "endLine": 18,
        "endChar": 34
      },
      "revId": "18950479acb0c2b5d097400656862aad6267f67b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "77b3b81b_788154dd",
        "filename": "services/core/java/com/android/server/wm/Task.java",
        "patchSetId": 2
      },
      "lineNbr": 5879,
      "author": {
        "id": 1381446
      },
      "writtenOn": "2024-10-14T04:19:12Z",
      "side": 1,
      "message": "Should we check `tr.isAttached` here instead?  Adding @erosky@google.com",
      "range": {
        "startLine": 5879,
        "startChar": 29,
        "endLine": 5879,
        "endChar": 39
      },
      "revId": "18950479acb0c2b5d097400656862aad6267f67b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e731a96_300d7f34",
        "filename": "services/core/java/com/android/server/wm/Task.java",
        "patchSetId": 2
      },
      "lineNbr": 5879,
      "author": {
        "id": 1650177
      },
      "writtenOn": "2024-10-14T04:28:33Z",
      "side": 1,
      "message": "1. `tr.getParent() \u003d\u003d this` also means it is attached.\n2. We need to make sure `tr` is still a child of `this`, otherwise the error is thrown when trying to reposition.\nhttps://source.corp.google.com/h/googleplex-android/platform/superproject/main/+/main:frameworks/base/services/core/java/com/android/server/wm/Task.java;l\u003d4870;drc\u003d84e9ad00e3e8ac600b1512e3239fee62732d9bec\n\nIf you mean whether we should check if `this` is still attached, I believe so because that means this operation is meaningless.\n\nA low chance corner case is when `this` is removed, while `tr` has been reparented - which I am not sure what the expected behavior is, but out of scope of this fix.",
      "parentUuid": "77b3b81b_788154dd",
      "range": {
        "startLine": 5879,
        "startChar": 29,
        "endLine": 5879,
        "endChar": 39
      },
      "revId": "18950479acb0c2b5d097400656862aad6267f67b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c7a7a379_b1abad6b",
        "filename": "services/core/java/com/android/server/wm/Task.java",
        "patchSetId": 2
      },
      "lineNbr": 5879,
      "author": {
        "id": 1381446
      },
      "writtenOn": "2024-10-14T04:38:18Z",
      "side": 1,
      "message": "My initial thought was that we could just replace `!isAttached()` to `!tr.isAttached()`. In that way, it ensures both the `tr` and it\u0027s parent are attached.\n\n\u003e We need to make sure tr is still a child of this, otherwise the error is thrown when trying to reposition.\n\nIIUC, this is not the original issue that the CL was trying to fix. However, we probably should check the parent-child relationship in the `#canMoveTaskToBack` method for that case?",
      "parentUuid": "5e731a96_300d7f34",
      "range": {
        "startLine": 5879,
        "startChar": 29,
        "endLine": 5879,
        "endChar": 39
      },
      "revId": "18950479acb0c2b5d097400656862aad6267f67b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5d877585_41962815",
        "filename": "services/core/java/com/android/server/wm/Task.java",
        "patchSetId": 2
      },
      "lineNbr": 5879,
      "author": {
        "id": 1564515
      },
      "writtenOn": "2024-10-14T04:44:15Z",
      "side": 1,
      "message": "I think than checking parent is better than ```tr.isAttached``` because ```tr``` can be reparanted to other root task before OnStartCollect is called. (e.g. Split-Screen).\nIn addition, if ```tr``` is removed, then transition will be aborted because ```tr.getParent()``` is null.",
      "parentUuid": "5e731a96_300d7f34",
      "range": {
        "startLine": 5879,
        "startChar": 29,
        "endLine": 5879,
        "endChar": 39
      },
      "revId": "18950479acb0c2b5d097400656862aad6267f67b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8e53c8df_974ebe56",
        "filename": "services/core/java/com/android/server/wm/Task.java",
        "patchSetId": 2
      },
      "lineNbr": 5879,
      "author": {
        "id": 1381446
      },
      "writtenOn": "2024-10-14T05:55:59Z",
      "side": 1,
      "message": "Thanks for the feedback! I can understand the benifit of doing so.\n\nWondering how do you think about my suggestion above (checks `tr.isAttached` here and verify the parent-child relationship in `#canMoveTaskToBack`)?",
      "parentUuid": "5d877585_41962815",
      "range": {
        "startLine": 5879,
        "startChar": 29,
        "endLine": 5879,
        "endChar": 39
      },
      "revId": "18950479acb0c2b5d097400656862aad6267f67b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f050e680_1f5ec3d4",
        "filename": "services/core/java/com/android/server/wm/Task.java",
        "patchSetId": 2
      },
      "lineNbr": 5879,
      "author": {
        "id": 1564515
      },
      "writtenOn": "2024-10-14T08:37:38Z",
      "side": 1,
      "message": "Thanks for your suggestion.\nI think your suggestion is also good to handle all cases.\n1. When tr is removed before ```OnStartCollect``` is called.\n- Both ```tr \u003d\u003d this``` and ```tr !\u003d this``` cases are covered by ```tr.isAttached```\n\n2. When ```tr``` is reparented to others before ```OnStartCollect``` is called.\n- If ```tr !\u003d this``` (a child task), then transition is aborted by ```canMoveTaskToBack``` false\n- If ```tr \u003d\u003d this``` (a root task?), then transition can be started if other conditions of ```canMoveTaskToBack``` are fine.\n\nPlease, correct me If I\u0027m wrong.",
      "parentUuid": "8e53c8df_974ebe56",
      "range": {
        "startLine": 5879,
        "startChar": 29,
        "endLine": 5879,
        "endChar": 39
      },
      "revId": "18950479acb0c2b5d097400656862aad6267f67b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}